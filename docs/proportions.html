<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Proportions | STAT 240 Revamp</title>
<meta name="author" content="Bi Cheng Wu, with help from Bret Larget">
<meta name="description" content="\(   \def\e{\operatorname{E}}   \def\p{\operatorname{P}}   \def\var{\operatorname{Var}}   \def\sd{\operatorname{SD}}   \def\bin{\operatorname{Bin}}   \def\n{\operatorname{N}}  ...">
<meta name="generator" content="bookdown 0.45.2 with bs4_book()">
<meta property="og:title" content="Chapter 12 Proportions | STAT 240 Revamp">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bwu62.github.io/stat240-revamp/proportions.html">
<meta property="og:description" content="\(   \def\e{\operatorname{E}}   \def\p{\operatorname{P}}   \def\var{\operatorname{Var}}   \def\sd{\operatorname{SD}}   \def\bin{\operatorname{Bin}}   \def\n{\operatorname{N}}  ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Proportions | STAT 240 Revamp">
<meta name="twitter:description" content="\(   \def\e{\operatorname{E}}   \def\p{\operatorname{P}}   \def\var{\operatorname{Var}}   \def\sd{\operatorname{SD}}   \def\bin{\operatorname{Bin}}   \def\n{\operatorname{N}}  ...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto_Mono-0.4.10/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.11.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.2/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-E0YDB40HWY"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0YDB40HWY');
    </script><link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
<link rel="manifest" href="icons/site.webmanifest">
<link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- https://www.bryanbraun.com/anchorjs/ --><script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script><script>
      // Add anchors on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('h1');
      anchors.add();
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 240 Revamp</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">1</span> Setup</a></li>
<li class="book-part">R Crash Course</li>
<li><a class="" href="rstudio-intro.html"><span class="header-section-number">2</span> Intro to R/Rstudio</a></li>
<li><a class="" href="data-vectors.html"><span class="header-section-number">3</span> Data Vectors</a></li>
<li><a class="" href="data-frames.html"><span class="header-section-number">4</span> Data Frames</a></li>
<li><a class="" href="data-exploration.html">Data Exploration</a></li>
<li><a class="" href="descriptive.html"><span class="header-section-number">5</span> Descriptive Statistics</a></li>
<li><a class="" href="data-visualization.html"><span class="header-section-number">6</span> Data Visualization</a></li>
<li><a class="" href="data-transformation.html">Data Transformation</a></li>
<li><a class="" href="intro-to-dplyr.html"><span class="header-section-number">7</span> Intro to dplyr</a></li>
<li><a class="" href="advanced-operations.html"><span class="header-section-number">8</span> Advanced Operations</a></li>
<li><a class="" href="data-modeling.html">Data Modeling</a></li>
<li><a class="" href="overview.html"><span class="header-section-number">9</span> Overview</a></li>
<li><a class="" href="intro-to-probability.html"><span class="header-section-number">10</span> Intro to Probability</a></li>
<li><a class="" href="sampling-inference.html"><span class="header-section-number">11</span> Sampling &amp; Inference</a></li>
<li><a class="" href="inference-types.html">Inference Types</a></li>
<li><a class="active" href="proportions.html"><span class="header-section-number">12</span> Proportions</a></li>
<li><a class="" href="means.html"><span class="header-section-number">13</span> Means</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">14</span> Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="datasets.html"><span class="header-section-number">A</span> Datasets</a></li>
<li><a class="" href="cheat-sheets.html"><span class="header-section-number">B</span> Cheat Sheets</a></li>
<li><a class="" href="additional-resources.html"><span class="header-section-number">C</span> Additional Resources</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bwu62/stat240-revamp">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><span style="display:none">
  \(
    \def\e{\operatorname{E}}
    \def\p{\operatorname{P}}
    \def\var{\operatorname{Var}}
    \def\sd{\operatorname{SD}}
    \def\bin{\operatorname{Bin}}
    \def\n{\operatorname{N}}
    \def\se{\operatorname{SE}}
    \def\asim{\mathrel{\dot\sim}}
    \def\obs{\text{obs}}
    \def\ep{\varepsilon}
    \def\new{\text{new}}
  \)
</span>
<div id="proportions" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Proportions<a class="anchor" aria-label="anchor" href="#proportions"><i class="fas fa-link"></i></a>
</h1>
<p>Let’s look specifically at proportions-type inference setups, where we apply a <strong>binomial model</strong> to sample proportions to infer about an underlying <strong>probability</strong> in the population. We will divide this into two scenarios:</p>
<ul>
<li>One-proportion scenario, where there is a single population with a single probability parameter of interest, and</li>
<li>Two-proportions scenario, where there are two populations, each with its own probability parameter, which we seek to compare.</li>
</ul>
<div class="note">
<p>A proportions-type inference approach using a binomial model is <strong>only appropriate</strong> if your sample consists of either 1 or 2 samples where, for each sample, your data looks like <strong>counts across two categories</strong>, one of which we consider “success” and the other “failure” (e.g. heads/tails, true/false, etc.).</p>
<p>In these setups, the probability parameter of the binomial model <strong>always corresponds to the probability of the <em>success</em> category</strong> by convention. Make sure to define the category whose probability is of primary interest as “success”.</p>
</div>
<div id="one-proportion" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> One proportion<a class="anchor" aria-label="anchor" href="#one-proportion"><i class="fas fa-link"></i></a>
</h2>
<div id="model-notation" class="section level3" number="12.1.1">
<h3>
<span class="header-section-number">12.1.1</span> Model notation<a class="anchor" aria-label="anchor" href="#model-notation"><i class="fas fa-link"></i></a>
</h3>
<p>In the one-proportion scenario, suppose we draw a <strong>fixed sample size of <span class="math inline">\(n\)</span></strong> observations, each of which we model as <strong>independent</strong> and having some constant underlying <strong>true probability <span class="math inline">\(p\)</span> of being a success</strong>, and <span class="math inline">\(1-p\)</span> of being a failure (and there’s no other possible outcome).</p>
<p>It’s customary to use upper-case <span class="math inline">\(X\)</span> to represent our model of the true distribution of <span class="math inline">\(x\)</span>, which here we choose to be <span class="math inline">\(X\sim\bin(n,p)\)</span>.</p>
<p>Let lower-case <strong><span class="math inline">\(x\)</span> be the observed number of successes in our sample</strong>, and note that we must have <span class="math inline">\(0\le x\le n\)</span>. Let <span class="math inline">\(\hat p=x/n\)</span> denote then the <strong>proportion of successes in our sample</strong>.</p>
<p>Under these assumptions, <span class="math inline">\(\hat p\)</span> is a natural <strong>point estimate</strong> for <span class="math inline">\(p\)</span>, i.e. our <strong>sample proportion of successes estimates the true underlying probability of success <span class="math inline">\(p\)</span></strong>, since the LLN guarantees <span class="math inline">\(\hat p\to p\)</span> as <span class="math inline">\(n\to\infty\)</span>.</p>
<div class="note">
<p>Note several things:</p>
<ul>
<li>
<span class="math inline">\(n\)</span> must be a fixed, predetermined sample size,</li>
<li>trials must be able to be reasonably modeled as independent,</li>
<li>there must only be 2 possible outcomes (success &amp; failure) for each trial,</li>
<li>
<span class="math inline">\(p\)</span> is always the TRUE probability of the “success” category, however it’s defined,</li>
<li>
<span class="math inline">\(\hat p\)</span> is the observed sample proportion, which can estimate the true <span class="math inline">\(p\)</span> by LLN,</li>
<li>
<span class="math inline">\(X\)</span> represents the theoretical RV model we choose to apply to the sample’s observed <span class="math inline">\(x\)</span>,</li>
<li>
<span class="math inline">\(x\)</span> represents the actual observed number of successes in your sample out of <span class="math inline">\(n\)</span> trials.</li>
</ul>
</div>
<div class="eg">
<p>Let’s see all this in the context of an example. Below are <span class="math inline">\(n=200\)</span> rolls of a purportedly fair 5-sided die I bought online (yes, I really sat in my office and rolled it 200 times).</p>
<div class="inline-figure"><img src="d5.jpg" class="i3"></div>
<div class="sourceCode" id="cb933"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine 50-roll chunks of data, split, then parse to numeric vector</span></span>
<span><span class="va">rolls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"21252134521555355115322514314333142113433335345333"</span>,</span>
<span>                <span class="st">"43242443535423223523352541521331244241531554241354"</span>,</span>
<span>                <span class="st">"34244524112155254341541335443433245314125431131335"</span>,</span>
<span>                <span class="st">"43114331251421521112234535251142334354341123345541"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">unlist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.numeric</span></span>
<span><span class="va">rolls</span></span></code></pre></div>
<pre><code>  [1] 2 1 2 5 2 1 3 4 5 2 1 5 5 5 3 5 5 1 1 5 3 2 2 5 1 4 3 1 4 3 3 3 1 4 2 1 1
 [38] 3 4 3 3 3 3 5 3 4 5 3 3 3 4 3 2 4 2 4 4 3 5 3 5 4 2 3 2 2 3 5 2 3 3 5 2 5
 [75] 4 1 5 2 1 3 3 1 2 4 4 2 4 1 5 3 1 5 5 4 2 4 1 3 5 4 3 4 2 4 4 5 2 4 1 1 2
[112] 1 5 5 2 5 4 3 4 1 5 4 1 3 3 5 4 4 3 4 3 3 2 4 5 3 1 4 1 2 5 4 3 1 1 3 1 3
[149] 3 5 4 3 1 1 4 3 3 1 2 5 1 4 2 1 5 2 1 1 1 2 2 3 4 5 3 5 2 5 1 1 4 2 3 3 4
[186] 3 5 4 3 4 1 1 2 3 3 4 5 5 4 1</code></pre>
<div class="sourceCode" id="cb935"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quick table + bar plot of results using base R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rolls</span><span class="op">)</span></span></code></pre></div>
<pre><code>rolls
 1  2  3  4  5 
39 32 50 41 38 </code></pre>
<div class="sourceCode" id="cb937"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rolls</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="i6">
<div class="inline-figure"><img src="12-proportions_files/figure-html/unnamed-chunk-5-1.svg" width="672" style="display: block; margin: auto;"></div>
</div>
<p>Suppose my question of interest is whether this specific die design is in fact fair. There are different ways of testing this<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;the most &lt;a href="https://www.scribbr.com/statistics/statistical-power"&gt;powerful&lt;/a&gt; method is probably a &lt;a href="https://www.scribbr.com/statistics/chi-square-tests"&gt;chi-squared test&lt;/a&gt;.&lt;/p&gt;'><sup>41</sup></a>, but a simple way using a proportions-type setup is to ask <strong>whether the two triangular-shaped faces</strong> (which are 4 and 5) <strong>are observed 2/5 or 40% of the time</strong>.</p>
<p>In this setup, we can define “success” as getting 4 or 5, which has theoretical probability <span class="math inline">\(p=0.4\)</span>. Our RV model for <span class="math inline">\(X\)</span>, i.e. the number of successes (4s &amp; 5s), is then <span class="math inline">\(X\sim\bin(200,0.4)\)</span>.</p>
<p>In our sample, we observed <span class="math inline">\(x=41+38=79\)</span> times this actually occurred, which gives us a sample proportion of <span class="math inline">\(\hat p=x/n=79/200=0.395\)</span>.</p>
</div>
</div>
<div id="confidence-interval" class="section level3" number="12.1.2">
<h3>
<span class="header-section-number">12.1.2</span> Confidence interval<a class="anchor" aria-label="anchor" href="#confidence-interval"><i class="fas fa-link"></i></a>
</h3>
<p>For a one-proportion scenario, the confidence interval has the following form:</p>
<p><span class="math display">\[
\text{$C\%$ or $(1\!-\!\alpha)$ interval}~=~\hat p~\pm~z_{\alpha/2}\cdot\sqrt{\frac{\hat p(1-\hat p)}{n}},~\text{ where}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\alpha\)</span> is <strong>implicitly defined as 100% – C%</strong>, e.g. for a 95% confidence interval, <span class="math inline">\(\alpha=1-0.95=0.05\)</span>,</p></li>
<li><p><span class="math inline">\(\hat p=x/n\)</span>, the sample proportion of successes, is the <strong>point estimate</strong> for the true probability <span class="math inline">\(p\)</span>,</p></li>
<li>
<p><span class="math inline">\(z_{\alpha/2}\)</span> is the <strong><span class="math inline">\(\alpha\)</span>-level normal critical value</strong> such that <span class="math inline">\(\p(|Z|&gt;|z_{\alpha/2}|)=\p(Z&gt;z_{\alpha/2})+\p(Z&lt;-z_{\alpha/2})=\alpha\)</span>, in other words the observation on the standard normal such that the two “outer-tails” defined by it and its mirror image sum to <span class="math inline">\(\alpha\)</span> together.</p>
<div class="i5 fold s">
<div class="sourceCode" id="cb938"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stefanom.io/latex2exp/">latex2exp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dnorm</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dnorm</span>, geom<span class="op">=</span><span class="st">"area"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.025</span><span class="op">)</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dnorm</span>, geom<span class="op">=</span><span class="st">"area"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.025</span>,<span class="fl">.5</span>,<span class="fl">.975</span><span class="op">)</span><span class="op">)</span>, minor_breaks<span class="op">=</span><span class="cn">NULL</span>, expand<span class="op">=</span><span class="fl">0</span>,</span>
<span>                     labels<span class="op">=</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"$-z_{\\alpha/2}$"</span>,<span class="st">"0"</span>,<span class="st">"$z_{\\alpha/2}$"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="cn">NULL</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.4</span><span class="op">)</span>, expand<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title<span class="op">=</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="st">"$z_{\\alpha/2}$ critical value for Z (red areas sum to $\\alpha$)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="12-proportions_files/figure-html/unnamed-chunk-6-1.svg" width="355.2" style="display: block; margin: auto;"></div>
</div>
<p>This value is called <span class="math inline">\(z_{\alpha/2}\)</span> since by convention the subscript denotes the area of only the right-corner, which is <span class="math inline">\(\alpha/2\)</span> by symmetry. To compute <span class="math inline">\(\alpha/2\)</span> for a C% interval, you need to ask <code><a href="https://rdrr.io/r/stats/Normal.html">qnorm()</a></code> for the <span class="math inline">\((1-\alpha/2)\)</span>–percentile, e.g. for a 95% confidence interval, we seek the 97.5%-tile:</p>
<div class="sourceCode" id="cb939"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for a given α, e.g.</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="co"># compute the 1-α/2 percentile as the z_α/2 critical value</span></span>
<span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span></span></code></pre></div>
<pre><code>[1] 0.975</code></pre>
<div class="sourceCode" id="cb941"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span>  <span class="co"># often approximated as 1.96 or simply 2</span></span></code></pre></div>
<pre><code>[1] 1.959964</code></pre>
</li>
<li><p>and finally <span class="math inline">\(\se(\hat p)=\sqrt{\hat p(1-\hat p)/n}\)</span> is the <strong>estimated standard error of <span class="math inline">\(\hat p\)</span></strong>, which can be thought of as dividing the binomial SD by <span class="math inline">\(n\)</span> then substituting <span class="math inline">\(p\to\hat p\)</span> everywhere.</p></li>
</ul>
<div class="eg">
<p>Continuing the example above, a 95% confidence interval for <span class="math inline">\(p\)</span> based on 79 successes out of 200 trials can be computed as:</p>
<div class="sourceCode" id="cb943"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define x, n</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rolls</span><span class="op">&gt;=</span><span class="fl">4</span><span class="op">)</span> ; <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rolls</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code>[1] 79</code></pre>
<div class="sourceCode" id="cb945"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span></span></code></pre></div>
<pre><code>[1] 200</code></pre>
<div class="sourceCode" id="cb947"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define p-hat</span></span>
<span><span class="va">phat</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">/</span><span class="va">n</span>   <span class="co"># alternative shortcut: phat &lt;- mean(rolls&gt;=4)</span></span>
<span><span class="va">phat</span></span></code></pre></div>
<pre><code>[1] 0.395</code></pre>
<div class="sourceCode" id="cb949"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 95% confidence interval, using c(-1,1) as a shortcut for ±</span></span>
<span><span class="va">phat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">phat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.32725 0.46275</code></pre>
<p>Thus, a 95% confidence interval for <span class="math inline">\(p\)</span>, i.e. the true probability of 4 or 5, is (0.33,0.46), or in other words, <strong>we are 95% confident the true <span class="math inline">\(p\)</span> is between 0.33 and 0.46</strong>.</p>
<p>If a different level of confidence is desired, simply change the argument to <code><a href="https://rdrr.io/r/stats/Normal.html">qnorm()</a></code>:</p>
<div class="sourceCode" id="cb951"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># e.g. for 90% interval, implied alpha=0.10 so we want qnorm of (1-0.1/2)=0.95</span></span>
<span><span class="va">phat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">phat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.3381424 0.4518576</code></pre>
<div class="sourceCode" id="cb953"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a shortcut is to take the midpoint between the confidence level and 1</span></span>
<span><span class="co"># another example, for a 99% interval, we want qnorm of 0.995</span></span>
<span><span class="va">phat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.995</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">phat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.3059614 0.4840386</code></pre>
<p>Note the lower the confidence desired the smaller the interval, and vice versa the higher the confidence desired the larger the interval.</p>
</div>
</div>
<div id="hypothesis-test" class="section level3" number="12.1.3">
<h3>
<span class="header-section-number">12.1.3</span> Hypothesis test<a class="anchor" aria-label="anchor" href="#hypothesis-test"><i class="fas fa-link"></i></a>
</h3>
<p>For a one-proportion scenario, you wish to test the following hypotheses:</p>
<p><span class="math display">\[
H_0:p~=~p_0~~~~~~~\\
~~~~~~~~H_a:p~&lt;,\,\ne,\,\text{or}&gt;~p_0
\]</span></p>
<p>where <span class="math inline">\(p_0\)</span> is your hypothesized true probability under the null.</p>
<p>You start, as always, by <strong>assuming the null</strong>, i.e. suppose that <span class="math inline">\(X\sim\bin(n,p_0)\)</span>. Note this means your sample observation <span class="math inline">\(x\)</span> is drawn from this distribution.</p>
<p>For the p-value, simply <strong>compute the appropriate tail area of <span class="math inline">\(x\)</span> corresponding to the alternative</strong>. Remember the rule is for one-sided take the corresponding side tail, and for two-sided take the two outer tails (or take one outer tail and double it).</p>
<p>Then finally, compare with <span class="math inline">\(\alpha\)</span> and make a conclusion.</p>
<div class="eg">
<p>Continuing with the die example, we saw in our sample <span class="math inline">\(\hat p=0.395\)</span> was close to what we expect for a fair die where <span class="math inline">\(p_0=0.4\)</span>. Let’s formally test this. Recall from last chapter if we wish to reject <span class="math inline">\(H_0\)</span> if our sample statistic is too high OR too low, we choose the two-sided alternative. This applies here, since if <span class="math inline">\(\hat p\)</span> is too low or too high vs <span class="math inline">\(0.4\)</span>, we should reject. Thus, we choose:</p>
<p><span class="math display">\[
H_0:p=0.4\\
H_a:p\ne0.4
\]</span></p>
<p>Next, under the null we have <span class="math inline">\(X\sim\bin(200,0.4)\)</span>. This distribution is shown below, along with a red line at our observed sample <span class="math inline">\(x=79\)</span>.</p>
<div class="fold s">
<div class="sourceCode" id="cb955"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">=</span> <span class="va">n</span><span class="op">*</span><span class="fl">.4</span> ; <span class="va">sd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">.4</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">mu</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="va">sd</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">mu</span><span class="op">+</span><span class="fl">3</span><span class="op">*</span><span class="va">sd</span><span class="op">)</span>,p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">k</span>,<span class="va">n</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">k</span>,y<span class="op">=</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">x</span>, color<span class="op">=</span><span class="st">"red"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Distribution of X under null hypothesis, i.e. Bin({n},0.4)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="12-proportions_files/figure-html/unnamed-chunk-11-1.svg" width="672" style="display: block; margin: auto;"></div>
</div>
<p>Recall for a two-sided alternative, we take the “outer-tail” corresponding to our observed statistic and multiply by 2 to get our final p-value. Here, this means we look for <span class="math inline">\(2\cdot\p(X\le79)\)</span> where <span class="math inline">\(X\sim\bin(200,0.4)\)</span>.</p>
<div class="sourceCode" id="cb956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># our two-sided p-value here</span></span>
<span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">pbinom</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.9463115</code></pre>
<p><strong>Important note: if our sample <span class="math inline">\(x\)</span> were on the <em>RIGHT</em> half of the curve instead of the left, then the “outer-tail” here would be the <em>RIGHT</em> side tail, </strong>i.e. <span class="math inline">\(\p(X\ge x)\)</span>.</p>
<p>If instead our alternative had been <span class="math inline">\(&lt;\)</span> or <span class="math inline">\(&gt;\)</span>, then instead the p-value here would be <span class="math inline">\(\p(X\le79)\)</span> or <span class="math inline">\(\p(X\ge79)\)</span> respectively.</p>
<div class="sourceCode" id="cb958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># p-value if Ha had been p&lt;0.4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">pbinom</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.4731557</code></pre>
<div class="sourceCode" id="cb960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># p-value if Ha had been p&gt;0.4 (note the -1 to include the bar at x)</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">pbinom</a></span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.5838754</code></pre>
<p>In any of these cases, we see the p-value is quite large compared to <span class="math inline">\(\alpha\)</span>. This means our experimental result of <span class="math inline">\(x=79\)</span> was in fact close to our expectations, so there’s no evidence to refute the null. Thus, we do not reject the null, and we conclude the die appears to be fair.</p>
</div>
</div>
<div id="approximate-z-test" class="section level3" number="12.1.4">
<h3>
<span class="header-section-number">12.1.4</span> Approximate Z-test<a class="anchor" aria-label="anchor" href="#approximate-z-test"><i class="fas fa-link"></i></a>
</h3>
<p>Alternatively, a normal approximation can also be used—assuming the approximation is valid—resulting in a <strong>normal or Z-test</strong> for one proportion. Different sources list different conditions, but commonly the approximation is considered valid if you have at least 5 successes and 5 failures in your sample.</p>
<p>Under the null, the sample proportion <span class="math inline">\(\hat p\)</span> has an approximate normal distribution:</p>
<p><span class="math display">\[
\hat p\asim\n\left(p_0~,\sqrt{p_0(1-p_0)/n}\right)
\]</span></p>
<p>Thus, we can find the corresponding p-value by computing a <span class="math inline">\(z_\obs\)</span> test statistic:</p>
<p><span class="math display">\[
z_\obs=\frac{\hat p-p_0}{\sqrt{p_0(1-p_0)/n}}
\]</span></p>
<p>then finding the appropriate tail area. For additional accuracy, a continuity correction of <span class="math inline">\(\pm0.5/n\)</span> can be added/subtracted onto <span class="math inline">\(\hat p\)</span> depending on the direction of the tail.</p>
<div class="eg">
<p>For the die example, this would look like:</p>
<div class="sourceCode" id="cb962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute z_obs test statistic with continuity correction</span></span>
<span><span class="va">z_obs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">phat</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">/</span><span class="va">n</span> <span class="op">-</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.4</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">z_obs</span></span></code></pre></div>
<pre><code>[1] -0.07216878</code></pre>
<div class="sourceCode" id="cb964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute 2-sided p-value for our earlier test</span></span>
<span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">z_obs</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.9424676</code></pre>
<p>The result is comparable to our earlier p-value.</p>
</div>
</div>
<div id="r-method" class="section level3" number="12.1.5">
<h3>
<span class="header-section-number">12.1.5</span> R method<a class="anchor" aria-label="anchor" href="#r-method"><i class="fas fa-link"></i></a>
</h3>
<p>Of course, you can also use R to compute the interval or do the testing. This is a good way to check your manual calculations to make sure you did it right. The function for both is <code><a href="https://rdrr.io/r/stats/binom.test.html">binom.test()</a></code>. It accepts several arguments:</p>
<ul>
<li><p><code>x</code> is the observed sample count <span class="math inline">\(x\)</span></p></li>
<li><p><code>n</code> is the sample size <code>n</code></p></li>
<li><p><code>p</code> (defaults to 0.5) is the hypothesized proportion under the null <span class="math inline">\(p_0\)</span></p></li>
<li><p><code>alternative</code> (defaults to <code>"two.sided"</code>) controls the direction of the alternative and can be set instead to either <code>"greater"</code> or <code>"less"</code></p></li>
<li><p><code>conf.level</code> (defaults to 0.95) controls the desired confidence level</p></li>
</ul>
<p>Important note: setting a one-sided alternative will generate a one-sided confidence interval with one end at 0 or 1, which is generally not what we desire, so if you want a standard confidence interval as well as a one-sided test, you should run the function twice.</p>
<div class="eg">
<p>Continuing with the die example, recall we still have <code>x</code>, <code>n</code> defined</p>
<div class="sourceCode" id="cb966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1]  79 200</code></pre>
<p>Let’s compute a 95% confidence interval for our problem:</p>
<div class="sourceCode" id="cb968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, p<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 79, number of trials = 200, p-value = 0.9425
alternative hypothesis: true probability of success is not equal to 0.4
95 percent confidence interval:
 0.3267650 0.4663964
sample estimates:
probability of success 
                 0.395 </code></pre>
<p>Note this interval is very slightly wider than our computation, since it uses a modified method called the <a href="https://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Clopper%E2%80%93Pearson_interval">Clopper-Pearson</a> formula, which is technically slightly better than our method which is called the <a href="https://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Problems_with_using_a_normal_approximation_or_%22Wald_interval%22">Wald</a> interval, but this is beyond the scope of STAT240. For our purposes we will prefer the simpler Wald method.</p>
<p>We can also compute a 90% or 99% interval:</p>
<div class="sourceCode" id="cb970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, p<span class="op">=</span><span class="fl">0.4</span>, conf.level<span class="op">=</span><span class="fl">0.90</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 79, number of trials = 200, p-value = 0.9425
alternative hypothesis: true probability of success is not equal to 0.4
90 percent confidence interval:
 0.3371018 0.4552518
sample estimates:
probability of success 
                 0.395 </code></pre>
<div class="sourceCode" id="cb972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, p<span class="op">=</span><span class="fl">0.4</span>, conf.level<span class="op">=</span><span class="fl">0.99</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 79, number of trials = 200, p-value = 0.9425
alternative hypothesis: true probability of success is not equal to 0.4
99 percent confidence interval:
 0.3069060 0.4882182
sample estimates:
probability of success 
                 0.395 </code></pre>
<p>If you demand an R method for our simpler Wald interval (e.g. to check your own computation), the <code><a href="https://rdrr.io/cran/DescTools/man/BinomCI.html" title="https://rdrr.io/cran/DescTools/man/BinomCI.html" target="_blank">BinomCI()</a></code> function from the <code>DescTools</code> package works:</p>
<div class="sourceCode" id="cb974"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute wald interval to check our work</span></span>
<span><span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/BinomCI.html">BinomCI</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, <span class="fl">0.95</span>, method<span class="op">=</span><span class="st">"wald"</span><span class="op">)</span></span></code></pre></div>
<pre><code>       est  lwr.ci  upr.ci
[1,] 0.395 0.32725 0.46275</code></pre>
<p>For a hypothesis test, note the previous outputs all show that the two-sided p-value is 0.9425. This is once again very slightly different from our computation, since it uses a slightly more exact method where instead of doing <span class="math inline">\(2\cdot\p(X\le79)\)</span>, it computes <span class="math inline">\(\p(X\le79)+\p(X\ge81)\)</span>.</p>
<div class="sourceCode" id="cb976"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">pbinom</a></span><span class="op">(</span><span class="fl">79</span>,<span class="fl">200</span>,<span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">pbinom</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">200</span>,<span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 0.9424936</code></pre>
<p>Again, we can feel free to continue doubling the outer tail area on one side as an approximation, which should usually be fairly accurate. We can also run one-sided tests if we wish:</p>
<div class="sourceCode" id="cb978"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, p<span class="op">=</span><span class="fl">0.4</span>, alternative<span class="op">=</span><span class="st">"less"</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 79, number of trials = 200, p-value = 0.4732
alternative hypothesis: true probability of success is less than 0.4
95 percent confidence interval:
 0.0000000 0.4552518
sample estimates:
probability of success 
                 0.395 </code></pre>
<div class="sourceCode" id="cb980"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, p<span class="op">=</span><span class="fl">0.4</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 79, number of trials = 200, p-value = 0.5839
alternative hypothesis: true probability of success is greater than 0.4
95 percent confidence interval:
 0.3371018 1.0000000
sample estimates:
probability of success 
                 0.395 </code></pre>
<p>This time, the p-values are exactly what we found previously (up to rounding).</p>
</div>
</div>
</div>
<div id="two-proportions" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Two proportions<a class="anchor" aria-label="anchor" href="#two-proportions"><i class="fas fa-link"></i></a>
</h2>
<div id="model-notation-1" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> Model notation<a class="anchor" aria-label="anchor" href="#model-notation-1"><i class="fas fa-link"></i></a>
</h3>
<p>In the two-proportions scenario, suppose we draw <strong>samples of size <span class="math inline">\(n_1\)</span>, <span class="math inline">\(n_2\)</span> from two different populations</strong>, and we again assume everything is independent (both within and between the two samples). Suppose the populations have <strong>true probabilities <span class="math inline">\(p_1\)</span>, <span class="math inline">\(p_2\)</span> of succeeding</strong> for each trial, and again these are treated as true unknown constants.</p>
<p>Then, our models for the true distributions are <span class="math inline">\(X_1\sim\bin(n_1,p_1)\)</span> and <span class="math inline">\(X_2\sim\bin(n_2,p_2)\)</span>.</p>
<p>Let <strong><span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> be observed numbers of successes in our samples</strong> where <span class="math inline">\(0\le x_1\le n_1\)</span> and <span class="math inline">\(0\le x_2\le n_2\)</span> and define <strong><span class="math inline">\(\hat p_1=x_1/n_1\)</span>, <span class="math inline">\(\hat p_2=x_2/n_2\)</span> as the corresponding proportions of successes in our samples</strong>.</p>
<p>Again, we know from the LLN that <span class="math inline">\(\hat p_1\to p_1\)</span> and <span class="math inline">\(\hat p_2\to p_2\)</span> so we take <strong><span class="math inline">\(\hat p_1\)</span>, <span class="math inline">\(\hat p_2\)</span> as our point estimates for <span class="math inline">\(p_1\)</span>, <span class="math inline">\(p_2\)</span></strong>.</p>
<p>So far it’s all pretty intuitive.</p>
<div class="eg">
<p>Again, let’s see all this in the context of an example. Let’s use this dataset of <a href="https://archive.ics.uci.edu/dataset/277/thoracic+surgery+data">thoracic surgery outcomes</a> for lung cancer patients from the Wroclaw Thoracic Surgery Centre at the <a href="https://uwr.edu.pl/en">University of Wroclaw</a>. A slightly cleaned version can be found here: <a href="data/thoracic.csv"><code>thoracic.csv</code></a>.</p>
<div class="sourceCode" id="cb982"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remember to load packages and set any desired options</span></span>
<span><span class="va">thoracic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://bwu62.github.io/stat240-revamp/data/thoracic.csv"</span><span class="op">)</span></span>
<span><span class="va">thoracic</span></span></code></pre></div>
<pre><code># A tibble: 470 × 17
  dgn     fvc  fev1 perf  pain  haem  dysp  cough weak  size  type2dm mi6  
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt; &lt;lgl&gt;   &lt;lgl&gt;
1 DGN2   2.88  2.16 PRZ1  FALSE FALSE FALSE TRUE  TRUE  OC14  FALSE   FALSE
2 DGN3   3.4   1.88 PRZ0  FALSE FALSE FALSE FALSE FALSE OC12  FALSE   FALSE
3 DGN3   2.76  2.08 PRZ1  FALSE FALSE FALSE TRUE  FALSE OC11  FALSE   FALSE
4 DGN3   3.68  3.04 PRZ0  FALSE FALSE FALSE FALSE FALSE OC11  FALSE   FALSE
5 DGN3   2.44  0.96 PRZ2  FALSE TRUE  FALSE TRUE  TRUE  OC11  FALSE   FALSE
# ℹ 465 more rows
# ℹ 5 more variables: pad &lt;lgl&gt;, smoker &lt;lgl&gt;, asthma &lt;lgl&gt;, age &lt;dbl&gt;,
#   survive1 &lt;lgl&gt;</code></pre>
<p>There are a lot of columns here we can use (see linked page for explanations of all variables), but just to keep the example simple, suppose we want to see if patients who are smokers have worse 1-year survival rates than non-smokers (spoiler: they do).</p>
<p>Let’s consider population 1 to be non-smokers and population 2 to be smokers. For each population, we can use <code>dplyr</code> to calculate the number of 1-year survivors in each sample (<span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>) and divide by the total number of smokers and non-smokers (<span class="math inline">\(n_1\)</span>, <span class="math inline">\(n_2\)</span>) to get the 1-year survival rates for each group (<span class="math inline">\(\hat p_1\)</span>, <span class="math inline">\(\hat p_2\)</span>).</p>
<div class="sourceCode" id="cb984"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thoracic_smoker_summary</span> <span class="op">&lt;-</span> <span class="va">thoracic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">smoker</span>, <span class="va">survive1</span>, name<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">smoker</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, phat<span class="op">=</span><span class="va">x</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">thoracic_smoker_summary</span></span></code></pre></div>
<pre><code># A tibble: 2 × 4
  smoker     x     n  phat
  &lt;lgl&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1 FALSE     77    84 0.917
2 TRUE     323   386 0.837</code></pre>
<p>We can see now that <span class="math inline">\(x_1=77\)</span>, <span class="math inline">\(x_2=323\)</span>, <span class="math inline">\(n_1=84\)</span>, <span class="math inline">\(n_2=386\)</span>, <span class="math inline">\(\hat p_1=0.917\)</span>, <span class="math inline">\(\hat p_2=0.837\)</span>.</p>
<p>We can now take this dataset and proceed to find a confidence interval or conduct a hypothesis test.</p>
</div>
</div>
<div id="confidence-interval-1" class="section level3" number="12.2.2">
<h3>
<span class="header-section-number">12.2.2</span> Confidence interval<a class="anchor" aria-label="anchor" href="#confidence-interval-1"><i class="fas fa-link"></i></a>
</h3>
<p>For a two-proportions scenario, generally our goal is to run inference on the <strong>difference of the underlying population probabilities <span class="math inline">\(p_1-p_2\)</span></strong>. We think of this as our parameter of interest.</p>
<p>For this parameter, our point estimate naturally is the <strong>difference of our sample proportions <span class="math inline">\(\hat p_1-\hat p_2\)</span></strong>. Then, our interval takes the form:</p>
<p><span class="math display">\[
\text{$C\%$ or $(1\!-\!\alpha)$ interval}~=~(\hat p_1-\hat p_2)~\pm~z_{\alpha/2}\cdot\sqrt{\frac{\hat p_1(1-\hat p_1)}{n_1}+\frac{\hat p_2(1-\hat p_2)}{n_2}},~\text{ where}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\hat p_1-\hat p_2\)</span> is our point estimate of the true difference <span class="math inline">\(p_1-p_2\)</span>,</p></li>
<li><p><span class="math inline">\(z_{\alpha/2}\)</span> is the same <span class="math inline">\(\alpha\)</span>-level normal critical value,</p></li>
<li><p><span class="math inline">\(\sqrt{\frac{\hat p_1(1-\hat p_1)}{n_1}+\frac{\hat p_2(1-\hat p_2)}{n_2}}\)</span> is the <strong>standard error of the difference of our sample proportions</strong>, i.e. <span class="math inline">\(\se(\hat p_1-\hat p_2)\)</span>. This formula comes from the fact that for independent <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>, <span class="math inline">\(\var(X\pm Y)=\var(X)+\var(Y)\)</span></p></li>
</ul>
<div class="eg">
<p>Continuing with the thoracic surgery example, let’s compute the 95% confidence interval for the true difference of survival probability <span class="math inline">\(p_1-p_2\)</span> between smokers and non-smokers</p>
<div class="sourceCode" id="cb986"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># starting with summary, mutate to add se contribution from each group</span></span>
<span><span class="co"># then summarize to get the point estimate, combined se, and interval bounds</span></span>
<span><span class="co"># note -diff() is necessary to get row1-row2</span></span>
<span><span class="va">thoracic_smoker_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">phat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>p1mp2 <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">phat</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            lower95 <span class="op">=</span> <span class="va">p1mp2</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span>, upper95 <span class="op">=</span> <span class="va">p1mp2</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 4
   p1mp2     se lower95 upper95
   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 0.0799 0.0355  0.0102   0.150</code></pre>
<p>Thus we can see our 95% confidence interval for the true difference in probabilities is (0.010,0.15). In other words, based on the data, we’re 95% confident lung cancer patients who don’t smoke are between 1.0% and 15% more likely to survive for at least 1 year after receiving thoracic surgery than those who do smoke.</p>
</div>
</div>
<div id="hypothesis-test-1" class="section level3" number="12.2.3">
<h3>
<span class="header-section-number">12.2.3</span> Hypothesis test<a class="anchor" aria-label="anchor" href="#hypothesis-test-1"><i class="fas fa-link"></i></a>
</h3>
<p>Again, for a two-proportions scenario, we’re usually interested on inference for the <strong>difference of the underlying population probabilities <span class="math inline">\(p_1-p_2\)</span></strong>. For two proportions we must resort to the approximate normal or Z-test, which is typically considered a valid approximation as long as you have <strong>at least 5 successes and 5 failures in each sample</strong>. The hypotheses are:</p>
<p><span class="math display">\[
H_0:p_1-p_2~=~d~~~~~~~\\
~~~~~~~~H_a:p_1-p_2~&lt;,\,\ne,\,\text{or}&gt;~d
\]</span></p>
<p>where <span class="math inline">\(d\)</span> is your hypothesized true difference in the populations’ probabilities under the null. By far the most common case is <span class="math inline">\(d=0\)</span> which means we end up testing the following:</p>
<p><span class="math display">\[
H_0:p_1~=~p_2~~~~~~~~\\
~~~~~~~H_a:p_1~&lt;,\,\ne,\,\text{or}&gt;~p_2
\]</span></p>
<p>For STAT240 we will focus on this <span class="math inline">\(d=0\)</span> case<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;the case where &lt;span class="math inline"&gt;\(d\ne0\)&lt;/span&gt; becomes quite complicated if you wish to keep using the &lt;a href="https://en.wikipedia.org/wiki/Score_test"&gt;score test&lt;/a&gt;, which is what we’ve been doing, and which is generally recommended due to good performance&lt;/p&gt;'><sup>42</sup></a>, where under the null the two populations have the same probability and any observed differences in sample proportion are due to random chance, and we must compute a “pooled” sample proportion estimate <span class="math inline">\(\bar p\)</span>, since it doesn’t make sense to have two different sample proportion estimates.</p>
<p><span class="math display">\[
\bar p=\frac{x_1+x_2}{n_1+n_2}
\]</span></p>
<p>Then, we compute our <span class="math inline">\(z_\obs\)</span> test statistic as:</p>
<p><span class="math display">\[
z_\obs=\frac{(\hat p_1-\hat p_2)-0}{\sqrt{\bar p(1-\bar p)\left(\frac1{n_1}+\frac1{n_2}\right)}}
\]</span></p>
<p>Finally, we compute our p-value by taking the appropriate tail area.</p>
<div class="eg">
<p>Continuing with the thoracic surgery example, where we defined sample 1 as non-smokers and sample 2 as smokers, it makes sense to ask if non-smokers have higher rates of 1-year survival than smokers. Thus, we choose these hypotheses:</p>
<p><span class="math display">\[
H_0:p_1-p_2=0\\
H_a:p_1-p_2&gt;0
\]</span></p>
<p>or in other words,</p>
<p><span class="math display">\[
H_0:p_1=p_2\\
H_a:p_1&gt;p_2
\]</span></p>
<p>Then, applying the above formulae, we obtain:</p>
<div class="sourceCode" id="cb988"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thoracic_smoker_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>p1mp2 <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">phat</span><span class="op">)</span>, pbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>            z <span class="op">=</span> <span class="va">p1mp2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pbar</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pbar</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>, pval <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 4
   p1mp2  pbar     z   pval
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 0.0799 0.851  1.86 0.0312</code></pre>
<p>Our test statistic <span class="math inline">\(z_\obs=1.86\)</span> gives us an upper-tail p-value of <span class="math inline">\(0.0312\)</span> which is less than the standard <span class="math inline">\(\alpha=0.05\)</span>, so we can reject the null here.</p>
<p>In summary, at the <span class="math inline">\(\alpha=0.05\)</span> significance level, the data suggests lung cancer patients who don’t smoke are significantly more likely to survive for at least 1 year after receiving thoracic surgery than those who do smoke.</p>
</div>
</div>
<div id="r-method-1" class="section level3" number="12.2.4">
<h3>
<span class="header-section-number">12.2.4</span> R method<a class="anchor" aria-label="anchor" href="#r-method-1"><i class="fas fa-link"></i></a>
</h3>
<p>The R method for analyzing two proportions is <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>, unlike <code><a href="https://rdrr.io/r/stats/binom.test.html">binom.test()</a></code> which can only handle one proportion. The arguments are similar (see help page for details), except for <code>x</code> and <code>n</code> we input a vector of success counts and sample sizes corresponding to our two samples. Note the alternative, if one-sided, indicates if the first sample is less/greater than the second sample.</p>
<p>Note the print-out of <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> actually references a <span class="math inline">\(\chi^2\)</span>-test instead of a normal-based test, but they are equivalent formulations of the same methodology and will produce the exact same intervals and p-values, as we’ll see in the example below.</p>
<div class="eg">
<p>Continuing with the thoracic surgery example, recall our sample statistics:</p>
<div class="sourceCode" id="cb990"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thoracic_smoker_summary</span></span></code></pre></div>
<pre><code># A tibble: 2 × 4
  smoker     x     n  phat
  &lt;lgl&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1 FALSE     77    84 0.917
2 TRUE     323   386 0.837</code></pre>
<p>For both interval and testing approaches, we must give the <code>x</code> and <code>n</code> columns to <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>. The other arguments depend on exactly what we wish to do.</p>
<p>To compute a proper 95% confidence interval for the true probability difference, we must always use the default two-sided alternative:</p>
<div class="sourceCode" id="cb992"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">77</span>,<span class="fl">323</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">84</span>,<span class="fl">386</span><span class="op">)</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    2-sample test for equality of proportions with continuity correction

data:  th$x out of th$n
X-squared = 2.8711, df = 1, p-value = 0.09018
alternative hypothesis: two.sided
95 percent confidence interval:
 0.002970985 0.156787219
sample estimates:
   prop 1    prop 2 
0.9166667 0.8367876 </code></pre>
<p>Note by default this also applies a continuity correction, which is generally recommended, where the interval is slightly widened by adjusting both upper and lower bounds by <span class="math inline">\(\pm0.5(1/n_1\!+\!1/n_2)\)</span>. We can verify this with a quick modification to our earlier computation:</p>
<div class="sourceCode" id="cb994"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thoracic_smoker_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">phat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>p1mp2 <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">phat</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           lower95 <span class="op">=</span> <span class="va">p1mp2</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span>, upper95 <span class="op">=</span> <span class="va">p1mp2</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">se</span>,</span>
<span>           lower95_cor <span class="op">=</span> <span class="va">lower95</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, upper95_cor <span class="op">=</span> <span class="va">upper95</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 6
   p1mp2     se lower95 upper95 lower95_cor upper95_cor
   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 0.0799 0.0355  0.0102   0.150     0.00297       0.157</code></pre>
<p>To forgo the continuity correction, simply add the argument <code>correct = FALSE</code>.</p>
<div class="sourceCode" id="cb996"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">77</span>,<span class="fl">323</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">84</span>,<span class="fl">386</span><span class="op">)</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, correct <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    2-sample test for equality of proportions without continuity correction

data:  th$x out of th$n
X-squared = 3.4727, df = 1, p-value = 0.06239
alternative hypothesis: two.sided
95 percent confidence interval:
 0.0102187 0.1495395
sample estimates:
   prop 1    prop 2 
0.9166667 0.8367876 </code></pre>
<p>To run a hypothesis instead, we must remember to set the correct alternative hypothesis direction. Here we want <code>"greater"</code> since group 1 is non-smokers, which we believe should have greater survival probability than non-smokers which are group 2.</p>
<div class="sourceCode" id="cb998"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">77</span>,<span class="fl">323</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">84</span>,<span class="fl">386</span><span class="op">)</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    2-sample test for equality of proportions with continuity correction

data:  th$x out of th$n
X-squared = 2.8711, df = 1, p-value = 0.04509
alternative hypothesis: greater
95 percent confidence interval:
 0.01417053 1.00000000
sample estimates:
   prop 1    prop 2 
0.9166667 0.8367876 </code></pre>
<p>Again, this includes by default the continuity correction, which is applied by <span class="math inline">\(\pm0.5(1/n_1\!+\!1/n_2)\)</span> onto <span class="math inline">\((\hat p_1\!-\!\hat p_2)\)</span> such that the absolute value is lowered in the <span class="math inline">\(z_\obs\)</span> equation, effectively slightly “shrinking” the observed difference in sample proportions. We can also verify this with a quick modification to our earlier computation:</p>
<div class="sourceCode" id="cb1000"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thoracic_smoker_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>p1mp2 <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">phat</span><span class="op">)</span>, pbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>            z <span class="op">=</span> <span class="va">p1mp2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pbar</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pbar</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>, pval <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,</span>
<span>            z_cor <span class="op">=</span> <span class="op">(</span><span class="va">p1mp2</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">p1mp2</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pbar</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pbar</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            pval_cor <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">z_cor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 6
   p1mp2  pbar     z   pval z_cor pval_cor
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 0.0799 0.851  1.86 0.0312  1.69   0.0451</code></pre>
<p>Again, if this is not desired, turn it off with <code>correct = FALSE</code></p>
<div class="sourceCode" id="cb1002"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">77</span>,<span class="fl">323</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">84</span>,<span class="fl">386</span><span class="op">)</span>, alternative <span class="op">=</span> <span class="st">"greater"</span>, correct <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>
    2-sample test for equality of proportions without continuity correction

data:  th$x out of th$n
X-squared = 3.4727, df = 1, p-value = 0.03119
alternative hypothesis: greater
95 percent confidence interval:
 0.02141825 1.00000000
sample estimates:
   prop 1    prop 2 
0.9166667 0.8367876 </code></pre>
<p>In either case, we can see everything matches perfectly and we are content.</p>
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js" defer></script><script>
  $(function(){
    $(".note").addClass("alert alert-warning");
  });
  $(function(){
    $(".tip").addClass("alert alert-success");
  });
  $(function(){
    $(".def").addClass("alert alert-info");
  });
  $(function(){
    $(".eg").addClass("alert alert-secondary");
  });
  $(function(){
    $(".col-lg-3").addClass("col-lg-2").removeClass("col-lg-3");
  });
  $(function(){
    $(".col-lg-7").addClass("col-lg-8").removeClass("col-lg-7");
  });
</script><!-- https://stackoverflow.com/a/37839683/25278020 --><script>
  $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show Source</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show Output</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show Plot</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});

</script><!-- https://www.tutorialrepublic.com/faq/how-to-change-href-attribute-of-a-hyperlink-using-jquery.php--><script>
  $(document).ready(function(){
    $("a.anchorjs-link").each(function(){
      var oldUrl = $(this).attr("href"); // Get current url
      var newUrl = oldUrl.replace(/^#(\d+-)+/,"#"); // Create new url
      $(this).attr("href", "#" + $(this).closest("div").attr("id"));  // Set href value
      $(this).attr("title", location.protocol + "//" + location.host + location.pathname + $(this).attr("href")); // Set title value
    });
  });
</script><!-- https://stackoverflow.com/a/10415599/25278020 --><script>
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.addedNodes && mutation.addedNodes.length > 0) {
            // element added to DOM
            var hasClass = [].some.call(mutation.addedNodes, function(el) {
                return el.classList.contains('bs-popover-top')
            });
            if (hasClass) {
              $("div.bs-popover-top a").each(function(){
                $(this).attr("target", "_blank");
              });
          }
        }
    });
});

var config = {
    attributes: true,
    childList: true,
    characterData: true
};

observer.observe(document.body, config);
</script><!--https://stackoverflow.com/a/49025957--><script>
  $(function() {
  $('a[class="footnote-ref"][data-toggle="popover"]').popover()
})

$('body')
  .on('mousedown', '.popover', function(e) {
    console.log("clicked inside popover")
    e.preventDefault()
  });
</script><div class="chapter-nav">
<div class="prev"><a href="inference-types.html">Inference Types</a></div>
<div class="next"><a href="means.html"><span class="header-section-number">13</span> Means</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#proportions"><span class="header-section-number">12</span> Proportions</a></li>
<li>
<a class="nav-link" href="#one-proportion"><span class="header-section-number">12.1</span> One proportion</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model-notation"><span class="header-section-number">12.1.1</span> Model notation</a></li>
<li><a class="nav-link" href="#confidence-interval"><span class="header-section-number">12.1.2</span> Confidence interval</a></li>
<li><a class="nav-link" href="#hypothesis-test"><span class="header-section-number">12.1.3</span> Hypothesis test</a></li>
<li><a class="nav-link" href="#approximate-z-test"><span class="header-section-number">12.1.4</span> Approximate Z-test</a></li>
<li><a class="nav-link" href="#r-method"><span class="header-section-number">12.1.5</span> R method</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#two-proportions"><span class="header-section-number">12.2</span> Two proportions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model-notation-1"><span class="header-section-number">12.2.1</span> Model notation</a></li>
<li><a class="nav-link" href="#confidence-interval-1"><span class="header-section-number">12.2.2</span> Confidence interval</a></li>
<li><a class="nav-link" href="#hypothesis-test-1"><span class="header-section-number">12.2.3</span> Hypothesis test</a></li>
<li><a class="nav-link" href="#r-method-1"><span class="header-section-number">12.2.4</span> R method</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bwu62/stat240-revamp/blob/master/12-proportions.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bwu62/stat240-revamp/edit/master/12-proportions.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 240 Revamp</strong>" was written by Bi Cheng Wu, with help from Bret Larget. It was last built on 2025-12-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
