<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Advanced operations | STAT 240 Revamp</title>
<meta name="author" content="Bi Cheng Wu, with help from Bret Larget and Cameron Jones">
<meta name="description" content="In this chapter, we will cover a few more advanced, yet incredibly useful data tidying operations like grouping, joining, and pivoting. Along the way, we will also make extensive use of dplyr...">
<meta name="generator" content="bookdown 0.40.1 with bs4_book()">
<meta property="og:title" content="Chapter 8 Advanced operations | STAT 240 Revamp">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bwu62.github.io/stat240-revamp/advanced-operations.html">
<meta property="og:description" content="In this chapter, we will cover a few more advanced, yet incredibly useful data tidying operations like grouping, joining, and pivoting. Along the way, we will also make extensive use of dplyr...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Advanced operations | STAT 240 Revamp">
<meta name="twitter:description" content="In this chapter, we will cover a few more advanced, yet incredibly useful data tidying operations like grouping, joining, and pivoting. Along the way, we will also make extensive use of dplyr...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-E0YDB40HWY"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0YDB40HWY');
    </script><link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
<link rel="manifest" href="icons/site.webmanifest">
<link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- https://www.bryanbraun.com/anchorjs/ --><script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script><script>
      // Add anchors on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('h1');
      anchors.add();
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 240 Revamp</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">1</span> Setup</a></li>
<li class="book-part">R crash course</li>
<li><a class="" href="rstudio-intro.html"><span class="header-section-number">2</span> Intro to R/Rstudio</a></li>
<li><a class="" href="data-vectors.html"><span class="header-section-number">3</span> Data Vectors</a></li>
<li><a class="" href="data-frames.html"><span class="header-section-number">4</span> Data Frames</a></li>
<li><a class="" href="data-exploration.html">Data Exploration</a></li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">5</span> Descriptive statistics</a></li>
<li><a class="" href="data-visualization.html"><span class="header-section-number">6</span> Data visualization</a></li>
<li><a class="" href="data-transformation.html">Data Transformation</a></li>
<li><a class="" href="intro-to-dplyr.html"><span class="header-section-number">7</span> Intro to dplyr</a></li>
<li><a class="active" href="advanced-operations.html"><span class="header-section-number">8</span> Advanced operations</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="datasets.html"><span class="header-section-number">A</span> Datasets</a></li>
<li><a class="" href="cheat-sheets.html"><span class="header-section-number">B</span> Cheat sheets</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bwu62/stat240-revamp">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="advanced-operations" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Advanced operations<a class="anchor" aria-label="anchor" href="#advanced-operations"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter, we will cover a few more advanced, yet incredibly useful data tidying operations like grouping, joining, and pivoting. Along the way, we will also make extensive use of dplyr functions learned in the previous chapter.</p>
<div id="grouping" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Grouping<a class="anchor" aria-label="anchor" href="#grouping"><i class="fas fa-link"></i></a>
</h2>
<p>Often, you will need to apply dplyr’s various operations like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, or slicing function not across the entire dataset but in groups. This is an important technique across data science, whether it’s data cleaning to exploration to visualization to modeling.</p>
<p>By default, data frames are not grouped when created or imported. You can create a grouping structure with the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. The basic syntax is <code>df %&gt;% group_by(col1, col2, ...)</code> where <code>col1</code>, <code>col2</code>, … are variables whose values are used to determine groups. You can group by just 1 variable, 2 variables, or as many variables as needed. <strong>Rows with the same values in the chosen columns will be grouped together</strong>.</p>
<p>After grouping, operations that normally run across all rows <strong>now run across each group</strong>. Here’s a few simple examples using the familiar penguins dataset to start:</p>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import tidyverse, change theme (optional), and load dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://bwu62.github.io/stat240-revamp/ggplot_theme_options.R"</span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://bwu62.github.io/stat240-revamp/data/penguins_complete.csv"</span>,</span>
<span>  show_col_types <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># group by species and get mean/median/sd body mass + sample size of each group</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    mean_mass   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    median_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    sd_mass     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    n           <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 3 × 5
  species   mean_mass median_mass sd_mass     n
  &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1 Adelie        3706.        3700    459.   146
2 Chinstrap     3733.        3700    384.    68
3 Gentoo        5092.        5050    501.   119</code></pre>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can also group by multiple, e.g. group by spcies + sex</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    mean_mass   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    median_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    sd_mass     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>    n           <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 6
# Groups:   species [3]
  species   sex    mean_mass median_mass sd_mass     n
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1 Adelie    female     3369.        3400    269.    73
2 Adelie    male       4043.        4000    347.    73
3 Chinstrap female     3527.        3550    285.    34
4 Chinstrap male       3939.        3950    362.    34
5 Gentoo    female     4680.        4700    282.    58
6 Gentoo    male       5485.        5500    313.    61</code></pre>
<div class="fold o">
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can of course also mutate within groups</span></span>
<span><span class="co"># e.g. convert bill length in mm to number of SDs</span></span>
<span><span class="co">#      away from species group mean</span></span>
<span><span class="co"># to better show the result, I'm forcing it to print all rows in order</span></span>
<span><span class="co"># but hiding the output in a collapsible box for style</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span>, <span class="va">bill_length_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    bill_length_std <span class="op">=</span> <span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_std</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 333 × 5
# Groups:   species [3]
    species   sex    bill_length_mm     n bill_length_std
    &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;           &lt;dbl&gt;
  1 Adelie    female           32.1   146        -2.53   
  2 Adelie    female           33.1   146        -2.15   
  3 Adelie    female           33.5   146        -2.00   
  4 Adelie    female           34     146        -1.81   
  5 Adelie    female           34.4   146        -1.66   
  6 Adelie    female           34.5   146        -1.62   
  7 Adelie    male             34.6   146        -1.59   
  8 Adelie    female           34.6   146        -1.59   
  9 Adelie    female           35     146        -1.44   
 10 Adelie    female           35     146        -1.44   
 11 Adelie    male             35.1   146        -1.40   
 12 Adelie    female           35.2   146        -1.36   
 13 Adelie    female           35.3   146        -1.32   
 14 Adelie    female           35.5   146        -1.25   
 15 Adelie    female           35.5   146        -1.25   
 16 Adelie    female           35.6   146        -1.21   
 17 Adelie    female           35.7   146        -1.17   
 18 Adelie    female           35.7   146        -1.17   
 19 Adelie    female           35.7   146        -1.17   
 20 Adelie    female           35.9   146        -1.10   
 21 Adelie    female           35.9   146        -1.10   
 22 Adelie    female           36     146        -1.06   
 23 Adelie    female           36     146        -1.06   
 24 Adelie    female           36     146        -1.06   
 25 Adelie    female           36     146        -1.06   
 26 Adelie    female           36.2   146        -0.985  
 27 Adelie    female           36.2   146        -0.985  
 28 Adelie    female           36.2   146        -0.985  
 29 Adelie    male             36.3   146        -0.948  
 30 Adelie    female           36.4   146        -0.910  
 31 Adelie    female           36.4   146        -0.910  
 32 Adelie    female           36.5   146        -0.873  
 33 Adelie    female           36.5   146        -0.873  
 34 Adelie    female           36.6   146        -0.835  
 35 Adelie    female           36.6   146        -0.835  
 36 Adelie    female           36.7   146        -0.798  
 37 Adelie    female           36.7   146        -0.798  
 38 Adelie    female           36.8   146        -0.760  
 39 Adelie    female           36.9   146        -0.723  
 40 Adelie    female           37     146        -0.685  
 41 Adelie    female           37     146        -0.685  
 42 Adelie    male             37.2   146        -0.610  
 43 Adelie    male             37.2   146        -0.610  
 44 Adelie    female           37.3   146        -0.572  
 45 Adelie    male             37.3   146        -0.572  
 46 Adelie    female           37.3   146        -0.572  
 47 Adelie    male             37.5   146        -0.497  
 48 Adelie    female           37.6   146        -0.460  
 49 Adelie    male             37.6   146        -0.460  
 50 Adelie    female           37.6   146        -0.460  
 51 Adelie    male             37.7   146        -0.422  
 52 Adelie    female           37.7   146        -0.422  
 53 Adelie    male             37.7   146        -0.422  
 54 Adelie    female           37.8   146        -0.385  
 55 Adelie    male             37.8   146        -0.385  
 56 Adelie    male             37.8   146        -0.385  
 57 Adelie    female           37.9   146        -0.347  
 58 Adelie    female           37.9   146        -0.347  
 59 Adelie    female           38.1   146        -0.272  
 60 Adelie    female           38.1   146        -0.272  
 61 Adelie    female           38.1   146        -0.272  
 62 Adelie    female           38.1   146        -0.272  
 63 Adelie    male             38.2   146        -0.234  
 64 Adelie    male             38.2   146        -0.234  
 65 Adelie    male             38.3   146        -0.197  
 66 Adelie    female           38.5   146        -0.122  
 67 Adelie    male             38.6   146        -0.0841 
 68 Adelie    female           38.6   146        -0.0841 
 69 Adelie    female           38.6   146        -0.0841 
 70 Adelie    female           38.7   146        -0.0466 
 71 Adelie    male             38.8   146        -0.00900
 72 Adelie    male             38.8   146        -0.00900
 73 Adelie    female           38.8   146        -0.00900
 74 Adelie    female           38.9   146         0.0286 
 75 Adelie    female           38.9   146         0.0286 
 76 Adelie    female           39     146         0.0661 
 77 Adelie    female           39     146         0.0661 
 78 Adelie    male             39     146         0.0661 
 79 Adelie    male             39.1   146         0.104  
 80 Adelie    male             39.2   146         0.141  
 81 Adelie    male             39.2   146         0.141  
 82 Adelie    male             39.2   146         0.141  
 83 Adelie    male             39.3   146         0.179  
 84 Adelie    female           39.5   146         0.254  
 85 Adelie    female           39.5   146         0.254  
 86 Adelie    female           39.5   146         0.254  
 87 Adelie    male             39.6   146         0.291  
 88 Adelie    female           39.6   146         0.291  
 89 Adelie    female           39.6   146         0.291  
 90 Adelie    male             39.6   146         0.291  
 91 Adelie    female           39.6   146         0.291  
 92 Adelie    male             39.7   146         0.329  
 93 Adelie    male             39.7   146         0.329  
 94 Adelie    female           39.7   146         0.329  
 95 Adelie    male             39.7   146         0.329  
 96 Adelie    male             39.8   146         0.367  
 97 Adelie    male             40.1   146         0.479  
 98 Adelie    female           40.2   146         0.517  
 99 Adelie    male             40.2   146         0.517  
100 Adelie    female           40.2   146         0.517  
101 Adelie    female           40.3   146         0.554  
102 Adelie    male             40.3   146         0.554  
103 Adelie    female           40.5   146         0.629  
104 Adelie    male             40.5   146         0.629  
105 Adelie    male             40.6   146         0.667  
106 Adelie    male             40.6   146         0.667  
107 Adelie    male             40.6   146         0.667  
108 Adelie    male             40.6   146         0.667  
109 Adelie    male             40.7   146         0.705  
110 Adelie    male             40.8   146         0.742  
111 Adelie    male             40.8   146         0.742  
112 Adelie    male             40.9   146         0.780  
113 Adelie    female           40.9   146         0.780  
114 Adelie    male             41     146         0.817  
115 Adelie    female           41.1   146         0.855  
116 Adelie    male             41.1   146         0.855  
117 Adelie    male             41.1   146         0.855  
118 Adelie    male             41.1   146         0.855  
119 Adelie    male             41.1   146         0.855  
120 Adelie    male             41.1   146         0.855  
121 Adelie    male             41.1   146         0.855  
122 Adelie    male             41.3   146         0.930  
123 Adelie    male             41.3   146         0.930  
124 Adelie    male             41.4   146         0.967  
125 Adelie    male             41.4   146         0.967  
126 Adelie    male             41.5   146         1.01   
127 Adelie    male             41.5   146         1.01   
128 Adelie    male             41.6   146         1.04   
129 Adelie    male             41.8   146         1.12   
130 Adelie    male             42     146         1.19   
131 Adelie    male             42.1   146         1.23   
132 Adelie    female           42.2   146         1.27   
133 Adelie    male             42.2   146         1.27   
134 Adelie    male             42.3   146         1.31   
135 Adelie    male             42.5   146         1.38   
136 Adelie    male             42.7   146         1.46   
137 Adelie    male             42.8   146         1.49   
138 Adelie    male             42.9   146         1.53   
139 Adelie    male             43.1   146         1.61   
140 Adelie    male             43.2   146         1.64   
141 Adelie    male             43.2   146         1.64   
142 Adelie    male             44.1   146         1.98   
143 Adelie    male             44.1   146         1.98   
144 Adelie    male             45.6   146         2.54   
145 Adelie    male             45.8   146         2.62   
146 Adelie    male             46     146         2.70   
147 Chinstrap female           40.9    68        -2.38   
148 Chinstrap female           42.4    68        -1.93   
149 Chinstrap female           42.5    68        -1.90   
150 Chinstrap female           42.5    68        -1.90   
151 Chinstrap female           43.2    68        -1.69   
152 Chinstrap female           43.5    68        -1.60   
153 Chinstrap female           45.2    68        -1.09   
154 Chinstrap female           45.2    68        -1.09   
155 Chinstrap female           45.4    68        -1.03   
156 Chinstrap female           45.5    68        -0.998  
157 Chinstrap female           45.6    68        -0.968  
158 Chinstrap female           45.7    68        -0.938  
159 Chinstrap female           45.7    68        -0.938  
160 Chinstrap female           45.9    68        -0.879  
161 Chinstrap female           46      68        -0.849  
162 Chinstrap female           46.1    68        -0.819  
163 Chinstrap female           46.2    68        -0.789  
164 Chinstrap female           46.4    68        -0.729  
165 Chinstrap female           46.4    68        -0.729  
166 Chinstrap female           46.5    68        -0.699  
167 Chinstrap female           46.6    68        -0.669  
168 Chinstrap female           46.7    68        -0.639  
169 Chinstrap female           46.8    68        -0.609  
170 Chinstrap female           46.9    68        -0.579  
171 Chinstrap female           47      68        -0.549  
172 Chinstrap female           47.5    68        -0.399  
173 Chinstrap female           47.6    68        -0.369  
174 Chinstrap female           48.1    68        -0.220  
175 Chinstrap male             48.5    68        -0.100  
176 Chinstrap male             49      68         0.0498 
177 Chinstrap male             49      68         0.0498 
178 Chinstrap male             49.2    68         0.110  
179 Chinstrap male             49.3    68         0.140  
180 Chinstrap male             49.5    68         0.199  
181 Chinstrap male             49.6    68         0.229  
182 Chinstrap male             49.7    68         0.259  
183 Chinstrap female           49.8    68         0.289  
184 Chinstrap male             50      68         0.349  
185 Chinstrap female           50.1    68         0.379  
186 Chinstrap male             50.2    68         0.409  
187 Chinstrap female           50.2    68         0.409  
188 Chinstrap male             50.3    68         0.439  
189 Chinstrap male             50.5    68         0.499  
190 Chinstrap female           50.5    68         0.499  
191 Chinstrap male             50.6    68         0.529  
192 Chinstrap male             50.7    68         0.559  
193 Chinstrap male             50.8    68         0.589  
194 Chinstrap male             50.8    68         0.589  
195 Chinstrap male             50.9    68         0.619  
196 Chinstrap female           50.9    68         0.619  
197 Chinstrap male             51      68         0.649  
198 Chinstrap male             51.3    68         0.739  
199 Chinstrap male             51.3    68         0.739  
200 Chinstrap male             51.3    68         0.739  
201 Chinstrap male             51.4    68         0.768  
202 Chinstrap male             51.5    68         0.798  
203 Chinstrap male             51.7    68         0.858  
204 Chinstrap male             51.9    68         0.918  
205 Chinstrap male             52      68         0.948  
206 Chinstrap male             52      68         0.948  
207 Chinstrap male             52      68         0.948  
208 Chinstrap male             52.2    68         1.01   
209 Chinstrap male             52.7    68         1.16   
210 Chinstrap male             52.8    68         1.19   
211 Chinstrap male             53.5    68         1.40   
212 Chinstrap male             54.2    68         1.61   
213 Chinstrap male             55.8    68         2.09   
214 Chinstrap female           58      68         2.74   
215 Gentoo    female           40.9   119        -2.15   
216 Gentoo    female           41.7   119        -1.89   
217 Gentoo    female           42     119        -1.79   
218 Gentoo    female           42.6   119        -1.60   
219 Gentoo    female           42.7   119        -1.57   
220 Gentoo    female           42.8   119        -1.54   
221 Gentoo    female           42.9   119        -1.50   
222 Gentoo    female           43.2   119        -1.41   
223 Gentoo    female           43.3   119        -1.37   
224 Gentoo    female           43.3   119        -1.37   
225 Gentoo    female           43.4   119        -1.34   
226 Gentoo    female           43.5   119        -1.31   
227 Gentoo    female           43.5   119        -1.31   
228 Gentoo    female           43.6   119        -1.28   
229 Gentoo    female           43.8   119        -1.21   
230 Gentoo    female           44     119        -1.15   
231 Gentoo    male             44.4   119        -1.02   
232 Gentoo    female           44.5   119        -0.988  
233 Gentoo    female           44.9   119        -0.859  
234 Gentoo    female           44.9   119        -0.859  
235 Gentoo    male             45     119        -0.827  
236 Gentoo    female           45.1   119        -0.795  
237 Gentoo    female           45.1   119        -0.795  
238 Gentoo    female           45.1   119        -0.795  
239 Gentoo    male             45.2   119        -0.762  
240 Gentoo    female           45.2   119        -0.762  
241 Gentoo    male             45.2   119        -0.762  
242 Gentoo    female           45.2   119        -0.762  
243 Gentoo    female           45.3   119        -0.730  
244 Gentoo    female           45.3   119        -0.730  
245 Gentoo    female           45.4   119        -0.698  
246 Gentoo    female           45.5   119        -0.666  
247 Gentoo    female           45.5   119        -0.666  
248 Gentoo    male             45.5   119        -0.666  
249 Gentoo    female           45.5   119        -0.666  
250 Gentoo    female           45.7   119        -0.601  
251 Gentoo    female           45.8   119        -0.569  
252 Gentoo    female           45.8   119        -0.569  
253 Gentoo    female           46.1   119        -0.473  
254 Gentoo    male             46.1   119        -0.473  
255 Gentoo    female           46.2   119        -0.440  
256 Gentoo    male             46.2   119        -0.440  
257 Gentoo    female           46.2   119        -0.440  
258 Gentoo    male             46.3   119        -0.408  
259 Gentoo    male             46.4   119        -0.376  
260 Gentoo    female           46.4   119        -0.376  
261 Gentoo    female           46.5   119        -0.344  
262 Gentoo    female           46.5   119        -0.344  
263 Gentoo    female           46.5   119        -0.344  
264 Gentoo    female           46.5   119        -0.344  
265 Gentoo    female           46.6   119        -0.312  
266 Gentoo    male             46.7   119        -0.279  
267 Gentoo    male             46.8   119        -0.247  
268 Gentoo    male             46.8   119        -0.247  
269 Gentoo    female           46.8   119        -0.247  
270 Gentoo    female           46.9   119        -0.215  
271 Gentoo    female           47.2   119        -0.118  
272 Gentoo    female           47.2   119        -0.118  
273 Gentoo    male             47.3   119        -0.0863 
274 Gentoo    female           47.4   119        -0.0541 
275 Gentoo    female           47.5   119        -0.0219 
276 Gentoo    female           47.5   119        -0.0219 
277 Gentoo    female           47.5   119        -0.0219 
278 Gentoo    male             47.6   119         0.0103 
279 Gentoo    female           47.7   119         0.0425 
280 Gentoo    male             47.8   119         0.0747 
281 Gentoo    male             48.1   119         0.171  
282 Gentoo    female           48.2   119         0.203  
283 Gentoo    male             48.2   119         0.203  
284 Gentoo    male             48.4   119         0.268  
285 Gentoo    male             48.4   119         0.268  
286 Gentoo    female           48.4   119         0.268  
287 Gentoo    male             48.5   119         0.300  
288 Gentoo    female           48.5   119         0.300  
289 Gentoo    male             48.6   119         0.332  
290 Gentoo    female           48.7   119         0.364  
291 Gentoo    male             48.7   119         0.364  
292 Gentoo    male             48.7   119         0.364  
293 Gentoo    male             48.8   119         0.397  
294 Gentoo    male             49     119         0.461  
295 Gentoo    female           49.1   119         0.493  
296 Gentoo    female           49.1   119         0.493  
297 Gentoo    male             49.1   119         0.493  
298 Gentoo    male             49.2   119         0.525  
299 Gentoo    male             49.3   119         0.558  
300 Gentoo    male             49.4   119         0.590  
301 Gentoo    male             49.5   119         0.622  
302 Gentoo    male             49.5   119         0.622  
303 Gentoo    male             49.6   119         0.654  
304 Gentoo    male             49.6   119         0.654  
305 Gentoo    male             49.8   119         0.719  
306 Gentoo    male             49.8   119         0.719  
307 Gentoo    male             49.9   119         0.751  
308 Gentoo    male             50     119         0.783  
309 Gentoo    male             50     119         0.783  
310 Gentoo    male             50     119         0.783  
311 Gentoo    male             50     119         0.783  
312 Gentoo    male             50.1   119         0.815  
313 Gentoo    male             50.2   119         0.847  
314 Gentoo    male             50.4   119         0.912  
315 Gentoo    male             50.4   119         0.912  
316 Gentoo    male             50.5   119         0.944  
317 Gentoo    male             50.5   119         0.944  
318 Gentoo    female           50.5   119         0.944  
319 Gentoo    male             50.7   119         1.01   
320 Gentoo    male             50.8   119         1.04   
321 Gentoo    male             50.8   119         1.04   
322 Gentoo    male             51.1   119         1.14   
323 Gentoo    male             51.1   119         1.14   
324 Gentoo    male             51.3   119         1.20   
325 Gentoo    male             51.5   119         1.27   
326 Gentoo    male             52.1   119         1.46   
327 Gentoo    male             52.2   119         1.49   
328 Gentoo    male             52.5   119         1.59   
329 Gentoo    male             53.4   119         1.88   
330 Gentoo    male             54.3   119         2.17   
331 Gentoo    male             55.1   119         2.42   
332 Gentoo    male             55.9   119         2.68   
333 Gentoo    male             59.6   119         3.87   </code></pre>
</div>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the largest 3 penguins by bill depth from each species</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 9 × 8
# Groups:   species [3]
  species   island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex  
  &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;
1 Adelie    Torgers…           46            21.5               194        4200 male 
2 Adelie    Torgers…           38.6          21.2               191        3800 male 
3 Adelie    Dream              42.3          21.2               191        4150 male 
4 Chinstrap Dream              54.2          20.8               201        4300 male 
5 Chinstrap Dream              52            20.7               210        4800 male 
6 Chinstrap Dream              51.7          20.3               194        3775 male 
7 Gentoo    Biscoe             44.4          17.3               219        5250 male 
8 Gentoo    Biscoe             50.8          17.3               228        5600 male 
9 Gentoo    Biscoe             52.2          17.1               228        5400 male 
# ℹ 1 more variable: year &lt;dbl&gt;</code></pre>
<div id="regrouping" class="section level3" number="8.1.1">
<h3>
<span class="header-section-number">8.1.1</span> Regrouping<a class="anchor" aria-label="anchor" href="#regrouping"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes one <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> may not be enough to get what you need; you may need to re-<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> by something else to finish the job. For example, suppose you want to see what percent of each species came from different islands. This requires two uses of <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>:</p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first group by species + island and summarize to get size of each group,</span></span>
<span><span class="co"># then regroup by species and MUTATE (not summarize) totals for each species,</span></span>
<span><span class="co"># then divide these to get proportion of each species from each island</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    species_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    pct_of_species_from_island <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="va">species_total</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 5 × 5
# Groups:   species [3]
  species   island        n species_total pct_of_species_from_island
  &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt;         &lt;int&gt;                      &lt;dbl&gt;
1 Adelie    Biscoe       44           146                       30.1
2 Adelie    Dream        55           146                       37.7
3 Adelie    Torgersen    47           146                       32.2
4 Chinstrap Dream        68            68                      100  
5 Gentoo    Biscoe      119           119                      100  </code></pre>
<p>This combination of <code>df %&gt;% group_by(...) %&gt;% summarize(n = n())</code> is so common, we have this shortcut for it: <code>df %&gt;% count(...)</code>. We can demonstrate this in another example involving regrouping. Suppose we want to know what percent of each species were male/female:</p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># again, first group by species + sex and get size using the shortcut count(),</span></span>
<span><span class="co"># then regroup by species and MUTATE totals for each species,</span></span>
<span><span class="co"># then divide to get proportions of each species that were male/female</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    species_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    pct_of_species_each_sex <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="va">species_total</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 5
# Groups:   species [3]
  species   sex        n species_total pct_of_species_each_sex
  &lt;chr&gt;     &lt;chr&gt;  &lt;int&gt;         &lt;int&gt;                   &lt;dbl&gt;
1 Adelie    female    73           146                    50  
2 Adelie    male      73           146                    50  
3 Chinstrap female    34            68                    50  
4 Chinstrap male      34            68                    50  
5 Gentoo    female    58           119                    48.7
6 Gentoo    male      61           119                    51.3</code></pre>
<p>Groups are also useful for prepping data frames for plotting. For example, here’s a chunk that produces a bar plot showing how mean body mass changes by species and sex:</p>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get mean body mass by species + sex and plot</span></span>
<span><span class="co"># the %T&gt;% is a special pipe called a Tee pipe</span></span>
<span><span class="co"># it's a shortcut for piping something into 2 different operations,</span></span>
<span><span class="co"># useful for example when you want to print a data frame, then also plot it</span></span>
<span><span class="co"># see https://magrittr.tidyverse.org/reference/tee.html for more</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">%T&gt;%</span> <span class="va">print</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">mean_mass</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Species"</span>, y <span class="op">=</span> <span class="st">"Mean body mass (g)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mean body mass of Palmer penguins by species + sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 3
# Groups:   species [3]
  species   sex    mean_mass
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
1 Adelie    female     3369.
2 Adelie    male       4043.
3 Chinstrap female     3527.
4 Chinstrap male       3939.
5 Gentoo    female     4680.
6 Gentoo    male       5485.</code></pre>
<div class="inline-figure"><img src="08-advanced-operations_files/figure-html/unnamed-chunk-8-1.svg" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="ungrouping" class="section level3" number="8.1.2">
<h3>
<span class="header-section-number">8.1.2</span> Ungrouping<a class="anchor" aria-label="anchor" href="#ungrouping"><i class="fas fa-link"></i></a>
</h3>
<p>Many operations output grouped data frames. For example, look closely at the output of the previous chunks and you’ll see <code># Groups:   species [3]</code> in most of them. This means any further operations you run will continue to execute in a grouped way.</p>
<p>You can remove the grouping structure with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>. This allows you to revert to running operations on the entire data frame. Example:</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get count of each species + sex combination,</span></span>
<span><span class="co"># but this time get its percentage out of ALL observations</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct_of_all <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 4
  species   sex        n pct_of_all
  &lt;chr&gt;     &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt;
1 Adelie    female    73      0.219
2 Adelie    male      73      0.219
3 Chinstrap female    34      0.102
4 Chinstrap male      34      0.102
5 Gentoo    female    58      0.174
6 Gentoo    male      61      0.183</code></pre>
</div>
<div id="more-practice" class="section level3" number="8.1.3">
<h3>
<span class="header-section-number">8.1.3</span> More practice!<a class="anchor" aria-label="anchor" href="#more-practice"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s give the penguins dataset a rest and practice dplyr and grouping a bit more with a different dataset. The following chunk imports <a href="data/fertility.csv"><code>fertility.csv</code></a>, the cleaned global fertility data set from <a href="https://data.worldbank.org/indicator/SP.DYN.TFRT.IN">World Bank</a>, giving the average number of births per woman for each year and country from 1960 to present. For the past few decades, global fertility has been <a href="https://ourworldindata.org/un-population-2024-revision">sharply declining</a> for most countries. Many countries are now below the <a href="https://en.wikipedia.org/wiki/Sub-replacement_fertility">replacement rate of 2.1</a>, leading to widespread concerns of a population collapse in the latter part of the 21<sup>st</sup> century.</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fertility</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://bwu62.github.io/stat240-revamp/data/fertility.csv"</span>,</span>
<span>  show_col_types <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fertility</span></span></code></pre></div>
<pre><code># A tibble: 13,050 × 5
   country     region     income_group  year  rate
   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
 1 Afghanistan South Asia Low           1960  7.28
 2 Afghanistan South Asia Low           1961  7.28
 3 Afghanistan South Asia Low           1962  7.29
 4 Afghanistan South Asia Low           1963  7.30
 5 Afghanistan South Asia Low           1964  7.30
 6 Afghanistan South Asia Low           1965  7.30
 7 Afghanistan South Asia Low           1966  7.32
 8 Afghanistan South Asia Low           1967  7.34
 9 Afghanistan South Asia Low           1968  7.36
10 Afghanistan South Asia Low           1969  7.39
# ℹ 13,040 more rows</code></pre>
<p>Each country has over 60 years of data in this dataset. We can see an overview which countries are represented in the dataset and what their listed region and income group are by temporarily dropping years, removing duplicates, and printing the full output below in a collapsible box:</p>
<div class="fold o">
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fertility</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span><span class="op">:</span><span class="va">income_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 212 × 3
    country                        region                     income_group
    &lt;chr&gt;                          &lt;chr&gt;                      &lt;chr&gt;       
  1 Afghanistan                    South Asia                 Low         
  2 Albania                        Europe &amp; Central Asia      Upper middle
  3 Algeria                        Middle East &amp; North Africa Upper middle
  4 Andorra                        Europe &amp; Central Asia      High        
  5 Angola                         Sub-Saharan Africa         Lower middle
  6 Antigua and Barbuda            Latin America &amp; Caribbean  High        
  7 Argentina                      Latin America &amp; Caribbean  Upper middle
  8 Armenia                        Europe &amp; Central Asia      Upper middle
  9 Aruba                          Latin America &amp; Caribbean  High        
 10 Australia                      East Asia &amp; Pacific        High        
 11 Austria                        Europe &amp; Central Asia      High        
 12 Azerbaijan                     Europe &amp; Central Asia      Upper middle
 13 Bahamas, The                   Latin America &amp; Caribbean  High        
 14 Bahrain                        Middle East &amp; North Africa High        
 15 Bangladesh                     South Asia                 Lower middle
 16 Barbados                       Latin America &amp; Caribbean  High        
 17 Belarus                        Europe &amp; Central Asia      Upper middle
 18 Belgium                        Europe &amp; Central Asia      High        
 19 Belize                         Latin America &amp; Caribbean  Upper middle
 20 Benin                          Sub-Saharan Africa         Lower middle
 21 Bermuda                        North America              High        
 22 Bhutan                         South Asia                 Lower middle
 23 Bolivia                        Latin America &amp; Caribbean  Lower middle
 24 Bosnia and Herzegovina         Europe &amp; Central Asia      Upper middle
 25 Botswana                       Sub-Saharan Africa         Upper middle
 26 Brazil                         Latin America &amp; Caribbean  Upper middle
 27 British Virgin Islands         Latin America &amp; Caribbean  High        
 28 Brunei Darussalam              East Asia &amp; Pacific        High        
 29 Bulgaria                       Europe &amp; Central Asia      High        
 30 Burkina Faso                   Sub-Saharan Africa         Low         
 31 Burundi                        Sub-Saharan Africa         Low         
 32 Cabo Verde                     Sub-Saharan Africa         Lower middle
 33 Cambodia                       East Asia &amp; Pacific        Lower middle
 34 Cameroon                       Sub-Saharan Africa         Lower middle
 35 Canada                         North America              High        
 36 Central African Republic       Sub-Saharan Africa         Low         
 37 Chad                           Sub-Saharan Africa         Low         
 38 Channel Islands                Europe &amp; Central Asia      High        
 39 Chile                          Latin America &amp; Caribbean  High        
 40 China                          East Asia &amp; Pacific        Upper middle
 41 Colombia                       Latin America &amp; Caribbean  Upper middle
 42 Comoros                        Sub-Saharan Africa         Lower middle
 43 Congo, Dem. Rep.               Sub-Saharan Africa         Low         
 44 Congo, Rep.                    Sub-Saharan Africa         Lower middle
 45 Costa Rica                     Latin America &amp; Caribbean  Upper middle
 46 Croatia                        Europe &amp; Central Asia      High        
 47 Cuba                           Latin America &amp; Caribbean  Upper middle
 48 Curaçao                        Latin America &amp; Caribbean  High        
 49 Cyprus                         Europe &amp; Central Asia      High        
 50 Czechia                        Europe &amp; Central Asia      High        
 51 Côte d'Ivoire                  Sub-Saharan Africa         Lower middle
 52 Denmark                        Europe &amp; Central Asia      High        
 53 Djibouti                       Middle East &amp; North Africa Lower middle
 54 Dominica                       Latin America &amp; Caribbean  Upper middle
 55 Dominican Republic             Latin America &amp; Caribbean  Upper middle
 56 Ecuador                        Latin America &amp; Caribbean  Upper middle
 57 Egypt, Arab Rep.               Middle East &amp; North Africa Lower middle
 58 El Salvador                    Latin America &amp; Caribbean  Upper middle
 59 Equatorial Guinea              Sub-Saharan Africa         Upper middle
 60 Eritrea                        Sub-Saharan Africa         Low         
 61 Estonia                        Europe &amp; Central Asia      High        
 62 Eswatini                       Sub-Saharan Africa         Lower middle
 63 Ethiopia                       Sub-Saharan Africa         Low         
 64 Faroe Islands                  Europe &amp; Central Asia      High        
 65 Fiji                           East Asia &amp; Pacific        Upper middle
 66 Finland                        Europe &amp; Central Asia      High        
 67 France                         Europe &amp; Central Asia      High        
 68 French Polynesia               East Asia &amp; Pacific        High        
 69 Gabon                          Sub-Saharan Africa         Upper middle
 70 Gambia, The                    Sub-Saharan Africa         Low         
 71 Georgia                        Europe &amp; Central Asia      Upper middle
 72 Germany                        Europe &amp; Central Asia      High        
 73 Ghana                          Sub-Saharan Africa         Lower middle
 74 Gibraltar                      Europe &amp; Central Asia      High        
 75 Greece                         Europe &amp; Central Asia      High        
 76 Greenland                      Europe &amp; Central Asia      High        
 77 Grenada                        Latin America &amp; Caribbean  Upper middle
 78 Guam                           East Asia &amp; Pacific        High        
 79 Guatemala                      Latin America &amp; Caribbean  Upper middle
 80 Guinea                         Sub-Saharan Africa         Lower middle
 81 Guinea-Bissau                  Sub-Saharan Africa         Low         
 82 Guyana                         Latin America &amp; Caribbean  High        
 83 Haiti                          Latin America &amp; Caribbean  Lower middle
 84 Honduras                       Latin America &amp; Caribbean  Lower middle
 85 Hong Kong                      East Asia &amp; Pacific        High        
 86 Hungary                        Europe &amp; Central Asia      High        
 87 Iceland                        Europe &amp; Central Asia      High        
 88 India                          South Asia                 Lower middle
 89 Indonesia                      East Asia &amp; Pacific        Upper middle
 90 Iran, Islamic Rep.             Middle East &amp; North Africa Upper middle
 91 Iraq                           Middle East &amp; North Africa Upper middle
 92 Ireland                        Europe &amp; Central Asia      High        
 93 Isle of Man                    Europe &amp; Central Asia      High        
 94 Israel                         Middle East &amp; North Africa High        
 95 Italy                          Europe &amp; Central Asia      High        
 96 Jamaica                        Latin America &amp; Caribbean  Upper middle
 97 Japan                          East Asia &amp; Pacific        High        
 98 Jordan                         Middle East &amp; North Africa Lower middle
 99 Kazakhstan                     Europe &amp; Central Asia      Upper middle
100 Kenya                          Sub-Saharan Africa         Lower middle
101 Kiribati                       East Asia &amp; Pacific        Lower middle
102 Korea, Dem. People's Rep.      East Asia &amp; Pacific        Low         
103 Korea, Rep.                    East Asia &amp; Pacific        High        
104 Kosovo                         Europe &amp; Central Asia      Upper middle
105 Kuwait                         Middle East &amp; North Africa High        
106 Kyrgyz Republic                Europe &amp; Central Asia      Lower middle
107 Lao PDR                        East Asia &amp; Pacific        Lower middle
108 Latvia                         Europe &amp; Central Asia      High        
109 Lebanon                        Middle East &amp; North Africa Lower middle
110 Lesotho                        Sub-Saharan Africa         Lower middle
111 Liberia                        Sub-Saharan Africa         Low         
112 Libya                          Middle East &amp; North Africa Upper middle
113 Liechtenstein                  Europe &amp; Central Asia      High        
114 Lithuania                      Europe &amp; Central Asia      High        
115 Luxembourg                     Europe &amp; Central Asia      High        
116 Macao                          East Asia &amp; Pacific        High        
117 Madagascar                     Sub-Saharan Africa         Low         
118 Malawi                         Sub-Saharan Africa         Low         
119 Malaysia                       East Asia &amp; Pacific        Upper middle
120 Maldives                       South Asia                 Upper middle
121 Mali                           Sub-Saharan Africa         Low         
122 Malta                          Middle East &amp; North Africa High        
123 Marshall Islands               East Asia &amp; Pacific        Upper middle
124 Mauritania                     Sub-Saharan Africa         Lower middle
125 Mauritius                      Sub-Saharan Africa         Upper middle
126 Mexico                         Latin America &amp; Caribbean  Upper middle
127 Micronesia, Fed. Sts.          East Asia &amp; Pacific        Lower middle
128 Moldova                        Europe &amp; Central Asia      Upper middle
129 Mongolia                       East Asia &amp; Pacific        Upper middle
130 Montenegro                     Europe &amp; Central Asia      Upper middle
131 Morocco                        Middle East &amp; North Africa Lower middle
132 Mozambique                     Sub-Saharan Africa         Low         
133 Myanmar                        East Asia &amp; Pacific        Lower middle
134 Namibia                        Sub-Saharan Africa         Upper middle
135 Nauru                          East Asia &amp; Pacific        High        
136 Nepal                          South Asia                 Lower middle
137 Netherlands                    Europe &amp; Central Asia      High        
138 New Caledonia                  East Asia &amp; Pacific        High        
139 New Zealand                    East Asia &amp; Pacific        High        
140 Nicaragua                      Latin America &amp; Caribbean  Lower middle
141 Niger                          Sub-Saharan Africa         Low         
142 Nigeria                        Sub-Saharan Africa         Lower middle
143 North Macedonia                Europe &amp; Central Asia      Upper middle
144 Norway                         Europe &amp; Central Asia      High        
145 Oman                           Middle East &amp; North Africa High        
146 Pakistan                       South Asia                 Lower middle
147 Palau                          East Asia &amp; Pacific        High        
148 Panama                         Latin America &amp; Caribbean  High        
149 Papua New Guinea               East Asia &amp; Pacific        Lower middle
150 Paraguay                       Latin America &amp; Caribbean  Upper middle
151 Peru                           Latin America &amp; Caribbean  Upper middle
152 Philippines                    East Asia &amp; Pacific        Lower middle
153 Poland                         Europe &amp; Central Asia      High        
154 Portugal                       Europe &amp; Central Asia      High        
155 Puerto Rico                    Latin America &amp; Caribbean  High        
156 Qatar                          Middle East &amp; North Africa High        
157 Romania                        Europe &amp; Central Asia      High        
158 Russian Federation             Europe &amp; Central Asia      High        
159 Rwanda                         Sub-Saharan Africa         Low         
160 Samoa                          East Asia &amp; Pacific        Lower middle
161 San Marino                     Europe &amp; Central Asia      High        
162 Saudi Arabia                   Middle East &amp; North Africa High        
163 Senegal                        Sub-Saharan Africa         Lower middle
164 Serbia                         Europe &amp; Central Asia      Upper middle
165 Seychelles                     Sub-Saharan Africa         High        
166 Sierra Leone                   Sub-Saharan Africa         Low         
167 Singapore                      East Asia &amp; Pacific        High        
168 Sint Maarten (Dutch part)      Latin America &amp; Caribbean  High        
169 Slovak Republic                Europe &amp; Central Asia      High        
170 Slovenia                       Europe &amp; Central Asia      High        
171 Solomon Islands                East Asia &amp; Pacific        Lower middle
172 Somalia                        Sub-Saharan Africa         Low         
173 South Africa                   Sub-Saharan Africa         Upper middle
174 South Sudan                    Sub-Saharan Africa         Low         
175 Spain                          Europe &amp; Central Asia      High        
176 Sri Lanka                      South Asia                 Lower middle
177 St. Kitts and Nevis            Latin America &amp; Caribbean  High        
178 St. Lucia                      Latin America &amp; Caribbean  Upper middle
179 St. Martin (French part)       Latin America &amp; Caribbean  High        
180 St. Vincent and the Grenadines Latin America &amp; Caribbean  Upper middle
181 Sudan                          Sub-Saharan Africa         Low         
182 Suriname                       Latin America &amp; Caribbean  Upper middle
183 Sweden                         Europe &amp; Central Asia      High        
184 Switzerland                    Europe &amp; Central Asia      High        
185 Syrian Arab Republic           Middle East &amp; North Africa Low         
186 São Tomé and Principe          Sub-Saharan Africa         Lower middle
187 Tajikistan                     Europe &amp; Central Asia      Lower middle
188 Tanzania                       Sub-Saharan Africa         Lower middle
189 Thailand                       East Asia &amp; Pacific        Upper middle
190 Timor-Leste                    East Asia &amp; Pacific        Lower middle
191 Togo                           Sub-Saharan Africa         Low         
192 Tonga                          East Asia &amp; Pacific        Upper middle
193 Trinidad and Tobago            Latin America &amp; Caribbean  High        
194 Tunisia                        Middle East &amp; North Africa Lower middle
195 Turkmenistan                   Europe &amp; Central Asia      Upper middle
196 Turks and Caicos Islands       Latin America &amp; Caribbean  High        
197 Tuvalu                         East Asia &amp; Pacific        Upper middle
198 Türkiye                        Europe &amp; Central Asia      Upper middle
199 Uganda                         Sub-Saharan Africa         Low         
200 Ukraine                        Europe &amp; Central Asia      Upper middle
201 United Arab Emirates           Middle East &amp; North Africa High        
202 United Kingdom                 Europe &amp; Central Asia      High        
203 United States                  North America              High        
204 Uruguay                        Latin America &amp; Caribbean  High        
205 Uzbekistan                     Europe &amp; Central Asia      Lower middle
206 Vanuatu                        East Asia &amp; Pacific        Lower middle
207 Viet Nam                       East Asia &amp; Pacific        Lower middle
208 Virgin Islands (U.S.)          Latin America &amp; Caribbean  High        
209 West Bank and Gaza             Middle East &amp; North Africa Lower middle
210 Yemen, Rep.                    Middle East &amp; North Africa Low         
211 Zambia                         Sub-Saharan Africa         Lower middle
212 Zimbabwe                       Sub-Saharan Africa         Lower middle</code></pre>
</div>
<p>One additional small processing step we should do before continuing is convert <code>income.group</code> to an ordered factor (see section <a href="data-vectors.html#ordered-data">3.9.5</a>), which will be important later.</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fertility</span> <span class="op">&lt;-</span> <span class="va">fertility</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>  income_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">income_group</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Low"</span>, <span class="st">"Lower middle"</span>, <span class="st">"Upper middle"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can begin by running a few summaries to explore the dataset. To start, here’s a chunk showing the number of countries and median income group for countries in each region:</p>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># strangely, base R median doesn't work on ordered categories,</span></span>
<span><span class="co"># but we can use Median from DescTools instead</span></span>
<span><span class="va">fertility</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">region</span>, <span class="va">income_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, median <span class="op">=</span> <span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/Median.html">Median</a></span><span class="op">(</span><span class="va">income_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 7 × 3
  region                         n median      
  &lt;chr&gt;                      &lt;int&gt; &lt;ord&gt;       
1 Europe &amp; Central Asia         57 High        
2 North America                  3 High        
3 East Asia &amp; Pacific           35 Upper middle
4 Latin America &amp; Caribbean     40 Upper middle
5 Middle East &amp; North Africa    21 Upper middle
6 South Asia                     8 Lower middle
7 Sub-Saharan Africa            48 Lower middle</code></pre>
<p>Next, here’s a chunk showing the median fertility rate in each region for the most recent year of 2022, as well as the countries with the highest and lowest 2022 rates (and what the rates are) in each region:</p>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first filter to get the right year, then</span></span>
<span><span class="co"># sort by region, rate (so min, max are the first, last in each group)</span></span>
<span><span class="co"># then summarize to get median, and min/max country/rate</span></span>
<span><span class="va">fertility</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">rate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n           <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    median      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>    min_country <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span>,</span>
<span>    min         <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>    max_country <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span>,</span>
<span>    max         <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 7 × 7
  region                         n median min_country   min max_country       max
  &lt;chr&gt;                      &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1 North America                  3   1.33 Bermuda     1.3   United States    1.66
2 Europe &amp; Central Asia         55   1.53 Spain       1.16  Uzbekistan       3.31
3 Latin America &amp; Caribbean     40   1.74 Puerto Rico 0.9   Haiti            2.77
4 South Asia                     8   1.99 Bhutan      1.40  Afghanistan      4.52
5 East Asia &amp; Pacific           34   2.24 Hong Kong   0.701 Solomon Islands  3.92
6 Middle East &amp; North Africa    21   2.40 Malta       1.15  Yemen, Rep.      3.72
7 Sub-Saharan Africa            48   4.18 Mauritius   1.32  Niger            6.75</code></pre>
<p>We can also show the latest rate for each country, as well as the change from 2000, just before the start of the 21<sup>st</sup> century:</p>
<div class="fold o">
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first filter to get the right years, then</span></span>
<span><span class="co"># sort by country, year (so 2000, 2022 are first and last in each group)</span></span>
<span><span class="co"># then summarize to get 2000 and 2022 rates, mutate to get change,</span></span>
<span><span class="co"># then ungroup, distinct, and arrange to display a neat output</span></span>
<span><span class="co"># again, collapsing output due to lengthy print out</span></span>
<span><span class="va">fertility</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    rate2000 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>    rate2022 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>    change <span class="op">=</span> <span class="va">rate2022</span> <span class="op">-</span> <span class="va">rate2000</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">region</span>, <span class="va">rate2000</span>, <span class="va">change</span>, <span class="va">rate2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">rate2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 210 × 5
    country                        region                  rate2000   change rate2022
    &lt;chr&gt;                          &lt;chr&gt;                      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
  1 Hong Kong                      East Asia &amp; Pacific        1.03  -0.331      0.701
  2 Korea, Rep.                    East Asia &amp; Pacific        1.48  -0.702      0.778
  3 Puerto Rico                    Latin America &amp; Caribb…    2.05  -1.15       0.9  
  4 British Virgin Islands         Latin America &amp; Caribb…    1.87  -0.851      1.01 
  5 Singapore                      East Asia &amp; Pacific        1.6   -0.56       1.04 
  6 Macao                          East Asia &amp; Pacific        0.912  0.197      1.11 
  7 Malta                          Middle East &amp; North Af…    1.68  -0.53       1.15 
  8 Spain                          Europe &amp; Central Asia      1.22  -0.0600     1.16 
  9 China                          East Asia &amp; Pacific        1.63  -0.453      1.18 
 10 Aruba                          Latin America &amp; Caribb…    1.90  -0.725      1.18 
 11 Italy                          Europe &amp; Central Asia      1.26  -0.0200     1.24 
 12 Japan                          East Asia &amp; Pacific        1.36  -0.100      1.26 
 13 Poland                         Europe &amp; Central Asia      1.37  -0.109      1.26 
 14 Ukraine                        Europe &amp; Central Asia      1.12   0.149      1.26 
 15 Lithuania                      Europe &amp; Central Asia      1.39  -0.120      1.27 
 16 Bermuda                        North America              1.74  -0.44       1.3  
 17 Curaçao                        Latin America &amp; Caribb…    2.19  -0.89       1.3  
 18 Luxembourg                     Europe &amp; Central Asia      1.76  -0.45       1.31 
 19 Cyprus                         Europe &amp; Central Asia      1.64  -0.326      1.31 
 20 Thailand                       East Asia &amp; Pacific        1.61  -0.295      1.32 
 21 Finland                        Europe &amp; Central Asia      1.73  -0.41       1.32 
 22 Mauritius                      Sub-Saharan Africa         1.99  -0.67       1.32 
 23 Canada                         North America              1.51  -0.18       1.33 
 24 Jamaica                        Latin America &amp; Caribb…    2.21  -0.87       1.34 
 25 Bosnia and Herzegovina         Europe &amp; Central Asia      1.28   0.0630     1.35 
 26 Albania                        Europe &amp; Central Asia      2.23  -0.855      1.38 
 27 Bahamas, The                   Latin America &amp; Caribb…    2.10  -0.717      1.38 
 28 St. Lucia                      Latin America &amp; Caribb…    2.20  -0.815      1.39 
 29 Switzerland                    Europe &amp; Central Asia      1.5   -0.110      1.39 
 30 Bhutan                         South Asia                 3.41  -2.02       1.40 
 31 Austria                        Europe &amp; Central Asia      1.36   0.0500     1.41 
 32 Estonia                        Europe &amp; Central Asia      1.36   0.0500     1.41 
 33 Norway                         Europe &amp; Central Asia      1.85  -0.44       1.41 
 34 Russian Federation             Europe &amp; Central Asia      1.20   0.221      1.42 
 35 Greece                         Europe &amp; Central Asia      1.25   0.18       1.43 
 36 Portugal                       Europe &amp; Central Asia      1.55  -0.120      1.43 
 37 United Arab Emirates           Middle East &amp; North Af…    2.73  -1.29       1.44 
 38 Cuba                           Latin America &amp; Caribb…    1.58  -0.132      1.45 
 39 Germany                        Europe &amp; Central Asia      1.38   0.0750     1.46 
 40 Channel Islands                Europe &amp; Central Asia      1.49  -0.0180     1.47 
 41 Latvia                         Europe &amp; Central Asia      1.25   0.22       1.47 
 42 Liechtenstein                  Europe &amp; Central Asia      1.57  -0.100      1.47 
 43 Uruguay                        Latin America &amp; Caribb…    2.17  -0.685      1.48 
 44 Netherlands                    Europe &amp; Central Asia      1.72  -0.233      1.49 
 45 Belarus                        Europe &amp; Central Asia      1.32   0.178      1.50 
 46 Kosovo                         Europe &amp; Central Asia      2.66  -1.15       1.51 
 47 St. Kitts and Nevis            Latin America &amp; Caribb…    2.20  -0.684      1.51 
 48 Hungary                        Europe &amp; Central Asia      1.32   0.2        1.52 
 49 Sweden                         Europe &amp; Central Asia      1.54  -0.0200     1.52 
 50 Costa Rica                     Latin America &amp; Caribb…    2.41  -0.89       1.52 
 51 Belgium                        Europe &amp; Central Asia      1.67  -0.140      1.53 
 52 Croatia                        Europe &amp; Central Asia      1.39   0.140      1.53 
 53 Chile                          Latin America &amp; Caribb…    1.99  -0.448      1.54 
 54 Denmark                        Europe &amp; Central Asia      1.77  -0.22       1.55 
 55 Slovenia                       Europe &amp; Central Asia      1.26   0.29       1.55 
 56 Slovak Republic                Europe &amp; Central Asia      1.3    0.27       1.57 
 57 United Kingdom                 Europe &amp; Central Asia      1.64  -0.0700     1.57 
 58 Isle of Man                    Europe &amp; Central Asia      1.69  -0.123      1.57 
 59 Sint Maarten (Dutch part)      Latin America &amp; Caribb…    1.85  -0.278      1.57 
 60 Armenia                        Europe &amp; Central Asia      1.60  -0.0280     1.58 
 61 Antigua and Barbuda            Latin America &amp; Caribb…    2.20  -0.616      1.58 
 62 Dominica                       Latin America &amp; Caribb…    2.35  -0.763      1.59 
 63 Iceland                        Europe &amp; Central Asia      2.08  -0.491      1.59 
 64 North Macedonia                Europe &amp; Central Asia      1.86  -0.261      1.6  
 65 Trinidad and Tobago            Latin America &amp; Caribb…    1.77  -0.155      1.61 
 66 Czechia                        Europe &amp; Central Asia      1.15   0.468      1.62 
 67 Brazil                         Latin America &amp; Caribb…    2.26  -0.629      1.63 
 68 Australia                      East Asia &amp; Pacific        1.76  -0.126      1.63 
 69 Serbia                         Europe &amp; Central Asia      1.48   0.150      1.63 
 70 Barbados                       Latin America &amp; Caribb…    1.78  -0.141      1.63 
 71 Turks and Caicos Islands       Latin America &amp; Caribb…    2.51  -0.853      1.66 
 72 New Zealand                    East Asia &amp; Pacific        1.98  -0.32       1.66 
 73 United States                  North America              2.06  -0.391      1.66 
 74 Azerbaijan                     Europe &amp; Central Asia      2     -0.33       1.67 
 75 Maldives                       South Asia                 2.71  -1.03       1.68 
 76 Iran, Islamic Rep.             Middle East &amp; North Af…    2.02  -0.335      1.68 
 77 French Polynesia               East Asia &amp; Pacific        2.60  -0.908      1.69 
 78 Colombia                       Latin America &amp; Caribb…    2.57  -0.88       1.69 
 79 Ireland                        Europe &amp; Central Asia      1.89  -0.19       1.7  
 80 Brunei Darussalam              East Asia &amp; Pacific        2.35  -0.582      1.76 
 81 St. Vincent and the Grenadines Latin America &amp; Caribb…    2.34  -0.562      1.78 
 82 Bulgaria                       Europe &amp; Central Asia      1.26   0.52       1.78 
 83 Qatar                          Middle East &amp; North Af…    3.23  -1.45       1.78 
 84 El Salvador                    Latin America &amp; Caribb…    3.14  -1.36       1.78 
 85 Malaysia                       East Asia &amp; Pacific        2.91  -1.13       1.79 
 86 Korea, Dem. People's Rep.      East Asia &amp; Pacific        1.97  -0.176      1.79 
 87 France                         Europe &amp; Central Asia      1.89  -0.0960     1.79 
 88 Bahrain                        Middle East &amp; North Af…    2.78  -0.981      1.80 
 89 Moldova                        Europe &amp; Central Asia      1.50   0.301      1.8  
 90 Montenegro                     Europe &amp; Central Asia      2.06  -0.265      1.8  
 91 Mexico                         Latin America &amp; Caribb…    2.72  -0.913      1.80 
 92 Romania                        Europe &amp; Central Asia      1.31   0.5        1.81 
 93 Palau                          East Asia &amp; Pacific        1.83   0          1.83 
 94 Gibraltar                      Europe &amp; Central Asia      1.92  -0.0820     1.84 
 95 Greenland                      Europe &amp; Central Asia      2.33  -0.49       1.84 
 96 Argentina                      Latin America &amp; Caribb…    2.59  -0.715      1.88 
 97 Cabo Verde                     Sub-Saharan Africa         3.54  -1.66       1.88 
 98 Türkiye                        Europe &amp; Central Asia      2.50  -0.623      1.88 
 99 Viet Nam                       East Asia &amp; Pacific        2.07  -0.131      1.94 
100 Bangladesh                     South Asia                 3.22  -1.27       1.95 
101 Sri Lanka                      South Asia                 2.19  -0.217      1.97 
102 Grenada                        Latin America &amp; Caribb…    2.58  -0.596      1.99 
103 Belize                         Latin America &amp; Caribb…    3.63  -1.64       1.99 
104 Virgin Islands (U.S.)          Latin America &amp; Caribb…    2.06  -0.0600     2    
105 Ecuador                        Latin America &amp; Caribb…    3.10  -1.10       2.00 
106 Nepal                          South Asia                 3.94  -1.94       2.01 
107 India                          South Asia                 3.35  -1.34       2.01 
108 New Caledonia                  East Asia &amp; Pacific        2.59  -0.57       2.02 
109 Faroe Islands                  Europe &amp; Central Asia      2.58  -0.532      2.05 
110 Georgia                        Europe &amp; Central Asia      1.60   0.462      2.06 
111 Tunisia                        Middle East &amp; North Af…    2.05   0.0150     2.06 
112 Lebanon                        Middle East &amp; North Af…    2.50  -0.419      2.08 
113 Kuwait                         Middle East &amp; North Af…    2.74  -0.645      2.09 
114 Myanmar                        East Asia &amp; Pacific        2.78  -0.658      2.13 
115 Indonesia                      East Asia &amp; Pacific        2.54  -0.383      2.15 
116 Peru                           Latin America &amp; Caribb…    2.84  -0.681      2.16 
117 Dominican Republic             Latin America &amp; Caribb…    2.86  -0.612      2.25 
118 Nicaragua                      Latin America &amp; Caribb…    3.11  -0.827      2.28 
119 Panama                         Latin America &amp; Caribb…    2.74  -0.447      2.30 
120 Morocco                        Middle East &amp; North Af…    2.80  -0.497      2.30 
121 Seychelles                     Sub-Saharan Africa         2.08   0.240      2.32 
122 Cambodia                       East Asia &amp; Pacific        3.77  -1.45       2.32 
123 Suriname                       Latin America &amp; Caribb…    2.90  -0.573      2.32 
124 Honduras                       Latin America &amp; Caribb…    4.24  -1.90       2.34 
125 South Africa                   Sub-Saharan Africa         2.41  -0.0720     2.34 
126 Guatemala                      Latin America &amp; Caribb…    4.58  -2.23       2.35 
127 Guyana                         Latin America &amp; Caribb…    3.02  -0.648      2.37 
128 St. Martin (French part)       Latin America &amp; Caribb…    2.71  -0.329      2.38 
129 Saudi Arabia                   Middle East &amp; North Af…    4.12  -1.72       2.39 
130 Libya                          Middle East &amp; North Af…    2.85  -0.449      2.40 
131 Paraguay                       Latin America &amp; Caribb…    3.55  -1.11       2.44 
132 Lao PDR                        East Asia &amp; Pacific        4.4   -1.95       2.45 
133 Fiji                           East Asia &amp; Pacific        3.03  -0.564      2.46 
134 Guam                           East Asia &amp; Pacific        3.01  -0.457      2.55 
135 Oman                           Middle East &amp; North Af…    3.89  -1.33       2.57 
136 Bolivia                        Latin America &amp; Caribb…    3.99  -1.41       2.58 
137 Turkmenistan                   Europe &amp; Central Asia      2.90  -0.281      2.62 
138 Micronesia, Fed. Sts.          East Asia &amp; Pacific        4.28  -1.61       2.67 
139 Marshall Islands               East Asia &amp; Pacific        4.59  -1.92       2.67 
140 Syrian Arab Republic           Middle East &amp; North Af…    4.00  -1.30       2.70 
141 Philippines                    East Asia &amp; Pacific        3.71  -0.989      2.72 
142 Botswana                       Sub-Saharan Africa         3.31  -0.558      2.75 
143 Djibouti                       Middle East &amp; North Af…    4.58  -1.82       2.76 
144 Haiti                          Latin America &amp; Caribb…    4.39  -1.62       2.77 
145 Mongolia                       East Asia &amp; Pacific        2.26   0.519      2.77 
146 Eswatini                       Sub-Saharan Africa         4.00  -1.21       2.78 
147 Jordan                         Middle East &amp; North Af…    3.92  -1.13       2.79 
148 Kyrgyz Republic                Europe &amp; Central Asia      2.4    0.4        2.8  
149 Algeria                        Middle East &amp; North Af…    2.57   0.263      2.83 
150 Egypt, Arab Rep.               Middle East &amp; North Af…    3.44  -0.564      2.88 
151 Israel                         Middle East &amp; North Af…    2.95  -0.0600     2.89 
152 Lesotho                        Sub-Saharan Africa         3.66  -0.678      2.98 
153 Timor-Leste                    East Asia &amp; Pacific        5.98  -2.93       3.05 
154 Kazakhstan                     Europe &amp; Central Asia      1.8    1.25       3.05 
155 Tajikistan                     Europe &amp; Central Asia      4.01  -0.865      3.14 
156 Tuvalu                         East Asia &amp; Pacific        3.81  -0.663      3.14 
157 Papua New Guinea               East Asia &amp; Pacific        4.53  -1.36       3.16 
158 Tonga                          East Asia &amp; Pacific        4.11  -0.915      3.19 
159 Namibia                        Sub-Saharan Africa         3.98  -0.727      3.25 
160 Kiribati                       East Asia &amp; Pacific        4.07  -0.794      3.27 
161 Kenya                          Sub-Saharan Africa         5.14  -1.84       3.30 
162 Uzbekistan                     Europe &amp; Central Asia      2.58   0.728      3.31 
163 Pakistan                       South Asia                 5.26  -1.85       3.41 
164 West Bank and Gaza             Middle East &amp; North Af…    5.44  -2.01       3.44 
165 Zimbabwe                       Sub-Saharan Africa         3.97  -0.537      3.44 
166 Iraq                           Middle East &amp; North Af…    4.95  -1.50       3.44 
167 Gabon                          Sub-Saharan Africa         4.47  -1.01       3.46 
168 Nauru                          East Asia &amp; Pacific        3.64  -0.179      3.46 
169 Ghana                          Sub-Saharan Africa         4.85  -1.35       3.51 
170 Vanuatu                        East Asia &amp; Pacific        4.48  -0.783      3.70 
171 Yemen, Rep.                    Middle East &amp; North Af…    6.32  -2.60       3.72 
172 Rwanda                         Sub-Saharan Africa         5.92  -2.18       3.75 
173 São Tomé and Principe          Sub-Saharan Africa         5.18  -1.43       3.75 
174 Eritrea                        Sub-Saharan Africa         5.40  -1.61       3.79 
175 Madagascar                     Sub-Saharan Africa         5.40  -1.61       3.79 
176 Malawi                         Sub-Saharan Africa         6.04  -2.19       3.85 
177 Samoa                          East Asia &amp; Pacific        4.51  -0.639      3.88 
178 Sierra Leone                   Sub-Saharan Africa         6.36  -2.48       3.88 
179 Comoros                        Sub-Saharan Africa         5.30  -1.38       3.91 
180 Guinea-Bissau                  Sub-Saharan Africa         5.72  -1.80       3.92 
181 Solomon Islands                East Asia &amp; Pacific        4.76  -0.831      3.92 
182 Liberia                        Sub-Saharan Africa         5.88  -1.86       4.02 
183 Ethiopia                       Sub-Saharan Africa         6.56  -2.50       4.06 
184 Congo, Rep.                    Sub-Saharan Africa         4.76  -0.669      4.10 
185 Equatorial Guinea              Sub-Saharan Africa         5.83  -1.66       4.17 
186 Togo                           Sub-Saharan Africa         5.27  -1.07       4.20 
187 Zambia                         Sub-Saharan Africa         5.93  -1.68       4.24 
188 Guinea                         Sub-Saharan Africa         5.94  -1.63       4.30 
189 Senegal                        Sub-Saharan Africa         5.50  -1.18       4.31 
190 South Sudan                    Sub-Saharan Africa         7.51  -3.18       4.34 
191 Côte d'Ivoire                  Sub-Saharan Africa         5.81  -1.47       4.34 
192 Mauritania                     Sub-Saharan Africa         5.46  -1.12       4.34 
193 Cameroon                       Sub-Saharan Africa         5.53  -1.15       4.38 
194 Sudan                          Sub-Saharan Africa         5.38  -0.996      4.38 
195 Uganda                         Sub-Saharan Africa         6.83  -2.36       4.47 
196 Afghanistan                    South Asia                 7.53  -3.01       4.52 
197 Mozambique                     Sub-Saharan Africa         5.81  -1.25       4.56 
198 Gambia, The                    Sub-Saharan Africa         5.80  -1.21       4.59 
199 Tanzania                       Sub-Saharan Africa         5.69  -1.03       4.66 
200 Burkina Faso                   Sub-Saharan Africa         6.52  -1.85       4.66 
201 Benin                          Sub-Saharan Africa         5.89  -0.995      4.89 
202 Burundi                        Sub-Saharan Africa         6.87  -1.89       4.98 
203 Nigeria                        Sub-Saharan Africa         6.12  -0.981      5.14 
204 Angola                         Sub-Saharan Africa         6.64  -1.43       5.21 
205 Mali                           Sub-Saharan Africa         6.87  -1.01       5.87 
206 Central African Republic       Sub-Saharan Africa         5.92   0.00300    5.92 
207 Congo, Dem. Rep.               Sub-Saharan Africa         6.72  -0.612      6.11 
208 Somalia                        Sub-Saharan Africa         7.61  -1.41       6.20 
209 Chad                           Sub-Saharan Africa         7.25  -1.03       6.22 
210 Niger                          Sub-Saharan Africa         7.73  -0.983      6.75 </code></pre>
</div>

</div>
</div>
</div>



<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js" defer></script><script>
  $(function(){
    $(".note").addClass("alert alert-warning");
  });
  $(function(){
    $(".tip").addClass("alert alert-success");
  });
  $(function(){
    $(".def").addClass("alert alert-info");
  });
  $(function(){
    $(".def").addClass("alert alert-info");
  });
  $(function(){
    $(".col-lg-3").addClass("col-lg-2").removeClass("col-lg-3");
  });
  $(function(){
    $(".col-lg-7").addClass("col-lg-8").removeClass("col-lg-7");
  });
</script><!-- https://stackoverflow.com/a/37839683/25278020 --><script>
  $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show Source</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show Output</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show Plot</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});

</script><!-- https://www.tutorialrepublic.com/faq/how-to-change-href-attribute-of-a-hyperlink-using-jquery.php--><script>
  $(document).ready(function(){
    $("a.anchorjs-link").each(function(){
      var oldUrl = $(this).attr("href"); // Get current url
      var newUrl = oldUrl.replace(/^#(\d+-)+/,"#"); // Create new url
      $(this).attr("href", "#" + $(this).closest("div").attr("id"));  // Set href value
      $(this).attr("title", location.protocol + "//" + location.host + location.pathname + $(this).attr("href")); // Set title value
    });
  });
</script><!-- https://stackoverflow.com/a/10415599/25278020 --><script>
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.addedNodes && mutation.addedNodes.length > 0) {
            // element added to DOM
            var hasClass = [].some.call(mutation.addedNodes, function(el) {
                return el.classList.contains('bs-popover-top')
            });
            if (hasClass) {
              $("div.bs-popover-top a").each(function(){
                $(this).attr("target", "_blank");
              });
          }
        }
    });
});

var config = {
    attributes: true,
    childList: true,
    characterData: true
};

observer.observe(document.body, config);
</script><div class="chapter-nav">
<div class="prev"><a href="intro-to-dplyr.html"><span class="header-section-number">7</span> Intro to dplyr</a></div>
<div class="next"><a href="datasets.html"><span class="header-section-number">A</span> Datasets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#advanced-operations"><span class="header-section-number">8</span> Advanced operations</a></li>
<li>
<a class="nav-link" href="#grouping"><span class="header-section-number">8.1</span> Grouping</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#regrouping"><span class="header-section-number">8.1.1</span> Regrouping</a></li>
<li><a class="nav-link" href="#ungrouping"><span class="header-section-number">8.1.2</span> Ungrouping</a></li>
<li><a class="nav-link" href="#more-practice"><span class="header-section-number">8.1.3</span> More practice!</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bwu62/stat240-revamp/blob/master/08-advanced-operations.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bwu62/stat240-revamp/edit/master/08-advanced-operations.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 240 Revamp</strong>" was written by Bi Cheng Wu, with help from Bret Larget and Cameron Jones. It was last built on 2024-08-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
