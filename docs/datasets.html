<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Datasets | STAT 240 Revamp</title>
<meta name="author" content="Bi Cheng Wu, with help from Bret Larget and Cameron Jones">
<meta name="description" content="This page contains updating/processing scripts and additional info on all datasets used for the course, as well as some brief discussions of why they were chosen. Datasets are ordered by order of...">
<meta name="generator" content="bookdown 0.40.1 with bs4_book()">
<meta property="og:title" content="A Datasets | STAT 240 Revamp">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bwu62.github.io/stat240-revamp/datasets.html">
<meta property="og:description" content="This page contains updating/processing scripts and additional info on all datasets used for the course, as well as some brief discussions of why they were chosen. Datasets are ordered by order of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Datasets | STAT 240 Revamp">
<meta name="twitter:description" content="This page contains updating/processing scripts and additional info on all datasets used for the course, as well as some brief discussions of why they were chosen. Datasets are ordered by order of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-E0YDB40HWY"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E0YDB40HWY');
    </script><link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
<link rel="manifest" href="icons/site.webmanifest">
<link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- https://www.bryanbraun.com/anchorjs/ --><script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script><script>
      // Add anchors on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('h1');
      anchors.add();
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 240 Revamp</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">1</span> Setup</a></li>
<li class="book-part">R crash course</li>
<li><a class="" href="rstudio-intro.html"><span class="header-section-number">2</span> Intro to R/Rstudio</a></li>
<li><a class="" href="data-vectors.html"><span class="header-section-number">3</span> Data Vectors</a></li>
<li><a class="" href="data-frames.html"><span class="header-section-number">4</span> Data Frames</a></li>
<li><a class="" href="data-exploration.html">Data Exploration</a></li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">5</span> Descriptive statistics</a></li>
<li><a class="" href="data-visualization.html"><span class="header-section-number">6</span> Data visualization</a></li>
<li><a class="" href="data-transformation.html">Data Transformation</a></li>
<li><a class="" href="intro-to-dplyr.html"><span class="header-section-number">7</span> Intro to dplyr</a></li>
<li class="book-part">Appendix</li>
<li><a class="active" href="datasets.html"><span class="header-section-number">A</span> Datasets</a></li>
<li><a class="" href="cheat-sheets.html"><span class="header-section-number">B</span> Cheat sheets</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bwu62/stat240-revamp">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="datasets" class="section level1" number="8">
<h1>
<span class="header-section-number">A</span> Datasets<a class="anchor" aria-label="anchor" href="#datasets"><i class="fas fa-link"></i></a>
</h1>
<p>This page contains updating/processing scripts and additional info on all datasets used for the course, as well as some brief discussions of why they were chosen. Datasets are ordered by order of appearance in the notes.</p>
<p>Also, since this is mostly for me to keep track of datasets and processing scripts, it’s not as meticulously formatted like the rest of the notes, e.g. lines of code are not kept to ~80 characters, and comments may be brief, again they’re for me not you. I may also use more advanced syntax or additional packages. Read at your own discretion.</p>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/colearendt/xlsx">xlsx</a></span><span class="op">)</span></span></code></pre></div>
<div id="datasets-list" class="section level2" number="8.1">
<h2>
<span class="header-section-number">A.1</span> List of datasets<a class="anchor" aria-label="anchor" href="#datasets-list"><i class="fas fa-link"></i></a>
</h2>
<p>Here’s a convenient list of all dataset files generated. Note that <strong>not ALL files are used in the notes!</strong>. These are primarily for my own record keeping purposes. Also note that some files may automatically open a download prompt while others may not. To force download, right click on a file link and choose “Save link as”.</p>
<ul>
<li><a href="data/enrollment.csv"><code>enrollment.csv</code></a></li>
<li><a href="data/eruptions_recent.csv"><code>eruptions_recent.csv</code></a></li>
<li><a href="data/eruptions_recent.delim"><code>eruptions_recent.delim</code></a></li>
<li><a href="data/eruptions_recent.tsv"><code>eruptions_recent.tsv</code></a></li>
<li><a href="data/eruptions_recent.xlsx"><code>eruptions_recent.xlsx</code></a></li>
<li><a href="data/penguins.csv"><code>penguins.csv</code></a></li>
<li><a href="data/penguins_complete.csv"><code>penguins_complete.csv</code></a></li>
</ul>
<p>Alternatively, you can also run the following line, which will <strong>download ALL files above to your current working directory</strong>. It’s recommended to first set your working directory to an appropriate place before running this, e.g. to the <code>data/</code> directory in your <code>STAT240/</code> course folder.</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="st">"https://bwu62.github.io/stat240-revamp/data_list.txt"</span><span class="op">)</span>,</span>
<span>       \<span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">.</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="eruptions" class="section level2" number="8.2">
<h2>
<span class="header-section-number">A.2</span> Eruptions<a class="anchor" aria-label="anchor" href="#eruptions"><i class="fas fa-link"></i></a>
</h2>
<p>For introducing reading CSVs, I wanted a dataset with all 4 data types we discussed (numeric, logical, character, and date) and was interesting enough, but without too many columns or rows, and without any problems that would add to complexity since we’re just starting out. The <a href="https://volcano.si.edu/volcanolist_countries.cfm?country=United%20States">volcanic eruptions</a> dataset (specifically the “Holocene Eruptions”) table seemed to fit the bill nicely.</p>
<div id="load-raw-data" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">A.2.1</span> Load raw data<a class="anchor" aria-label="anchor" href="#load-raw-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load html source code</span></span>
<span><span class="va">eruptions_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="st">"https://volcano.si.edu/volcanolist_countries.cfm?country=United%20States"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># extract table code</span></span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span>xpath<span class="op">=</span><span class="st">"//table[@title='Holocene Eruptions']"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># convert to data frame</span></span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>header<span class="op">=</span><span class="cn">T</span>,na.strings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Uncertain"</span>,<span class="st">"Unknown"</span>,<span class="st">"[Unknown]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># remove list wrapper</span></span>
<span>  <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># remove unnecessary evidence column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Evidence</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># make names nice</span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"volcano"</span>,<span class="st">"start"</span>,<span class="st">"stop"</span>,<span class="st">"confirmed"</span>,<span class="st">"vei"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="process-data" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">A.2.2</span> Process data<a class="anchor" aria-label="anchor" href="#process-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eruptions</span> <span class="op">&lt;-</span> <span class="va">eruptions_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    volcano <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">volcano</span>,<span class="st">"°"</span>,<span class="st">"°"</span><span class="op">)</span>,</span>
<span>    <span class="co"># convert confirmed? column to logical</span></span>
<span>    confirmed <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">confirmed</span>,<span class="st">"NA"</span><span class="op">)</span><span class="op">==</span><span class="st">"Confirmed"</span>,<span class="cn">T</span>,<span class="cn">F</span><span class="op">)</span>,</span>
<span>    <span class="co"># replace continuing eruptions with today's date</span></span>
<span>    <span class="co"># (continuation last validated 7/23/24)</span></span>
<span>    stop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">stop</span>,<span class="st">"continu"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"%Y %b %e"</span><span class="op">)</span>,<span class="va">stop</span>,missing<span class="op">=</span><span class="va">stop</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># extract date error to new column</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">start</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"start_error"</span><span class="op">)</span>,<span class="st">"±"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">stop</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stop"</span>,<span class="st">"stop_error"</span><span class="op">)</span>,<span class="st">"±"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># fix a few names</span></span>
<span>    volcano <span class="op">=</span> <span class="va">volcano</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"Asuncion"</span>,<span class="st">"Asunción"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"Pajaros"</span>,<span class="st">"Pájaros"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"Kilauea"</span>,<span class="st">"Kīlauea"</span><span class="op">)</span>,</span>
<span>    <span class="co"># parse error time string to number of days</span></span>
<span>    start_error <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as.duration.html">as.duration</a></span><span class="op">(</span><span class="va">start_error</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    stop_error <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as.duration.html">as.duration</a></span><span class="op">(</span><span class="va">stop_error</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co"># extract start year since some earlier eruptions are missing month/day</span></span>
<span>    start_year <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">start</span>,<span class="st">"(\\d{4,5})"</span><span class="op">)</span>,</span>
<span>    stop_year <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">stop</span>,<span class="st">"(\\d{4,5})"</span><span class="op">)</span>,</span>
<span>    <span class="co"># parse start year, adding - if BCE</span></span>
<span>    start_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">start_year</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">start</span>,<span class="st">"BCE"</span><span class="op">)</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    stop_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">stop_year</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">stop</span>,<span class="st">"BCE"</span><span class="op">)</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co"># extract start month</span></span>
<span>    start_month <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">start</span>,<span class="st">".*\\d{4}\\s([:alpha:]{3}).*"</span>,<span class="st">"\\1"</span><span class="op">)</span>,</span>
<span>    stop_month <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">stop</span>,<span class="st">".*\\d{4}\\s([:alpha:]{3}).*"</span>,<span class="st">"\\1"</span><span class="op">)</span>,</span>
<span>    start <span class="op">=</span> <span class="va">start</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"\\[|\\]|\\(.*?\\)"</span>,<span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="st">"^\\s?\\d+\\s\\w+\\s\\d+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">ymd</span>,</span>
<span>    stop <span class="op">=</span> <span class="va">stop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"\\[|\\]|\\(.*?\\)"</span>,<span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="st">"^\\s?\\d+\\s\\w+\\s\\d+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">ymd</span>,</span>
<span>    <span class="co"># if missing date but has month, use middle day +- half-month error</span></span>
<span>    <span class="co"># first, compute number of days in each month</span></span>
<span>    start_mdays <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/days_in_month.html">days_in_month</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">start_year</span>,<span class="va">start_month</span>,<span class="st">"1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    stop_mdays <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/days_in_month.html">days_in_month</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">stop_year</span>,<span class="va">stop_month</span>,<span class="st">"1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># next, if start/stop NA but month exists, set error as half of number of days in month rounded up, then set no error (NA) as 0</span></span>
<span>    start_error <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">start_month</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">start_error</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">start_mdays</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,<span class="va">start_error</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    stop_error <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop_month</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop_error</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">stop_mdays</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,<span class="va">stop_error</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="co"># finally, if start/stop NA but month exists, set start/stop as middle day of month rounded down</span></span>
<span>    start <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">start_month</span><span class="op">)</span>,<span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">start_year</span>,<span class="va">start_month</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">start_mdays</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="va">start</span><span class="op">)</span>,</span>
<span>    stop <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop_month</span><span class="op">)</span>,<span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">stop_year</span>,<span class="va">stop_month</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">stop_mdays</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="va">stop</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="op">(</span><span class="va">stop</span><span class="op">-</span><span class="va">start</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># remove intermediate rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">volcano</span>,<span class="va">start</span>,<span class="va">start_error</span>,<span class="va">start_year</span>,<span class="va">stop</span>,<span class="va">stop_error</span>,<span class="va">stop_year</span>,<span class="va">duration</span>,<span class="va">confirmed</span>,<span class="va">vei</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get just subset for demo</span></span>
<span><span class="va">eruptions_recent</span> <span class="op">&lt;-</span> <span class="va">eruptions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">start_error</span> <span class="op">&lt;=</span> <span class="fl">30</span>, <span class="va">start_year</span> <span class="op">&gt;</span> <span class="fl">2000</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">stop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="write-out-data" class="section level3" number="8.2.3">
<h3>
<span class="header-section-number">A.2.3</span> Write out data<a class="anchor" aria-label="anchor" href="#write-out-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save complete file too</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">eruptions</span>,file<span class="op">=</span><span class="st">"data/eruptions.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write out to different formats for reading</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">eruptions_recent</span>,file<span class="op">=</span><span class="st">"data/eruptions_recent.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_tsv</a></span><span class="op">(</span><span class="va">eruptions_recent</span>,file<span class="op">=</span><span class="st">"data/eruptions_recent.tsv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">eruptions_recent</span>,file<span class="op">=</span><span class="st">"data/eruptions_recent.delim"</span>,delim<span class="op">=</span><span class="st">"|"</span>,na<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">eruptions_recent</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"data/eruptions_recent.xlsx"</span>,row.names<span class="op">=</span><span class="cn">F</span>,showNA<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># originally line below was b/c I wanted to prep example for read_table but turns out</span></span>
<span><span class="co"># its behavior changed recentlyish https://www.tidyverse.org/blog/2021/07/readr-2-0-0/</span></span>
<span><span class="co"># it no longer works well here, and read.table needs to be used instead</span></span>
<span><span class="co"># (alternatively read_fwf from readr also works but that seems beyond scope)</span></span>
<span><span class="co"># but I don't want to confuse students by introducing a mix of readr + base R</span></span>
<span><span class="co"># so quitting this example, need to reevaluate in the future importance</span></span>
<span><span class="co"># of reading whitespace aligned table formats</span></span>
<span></span>
<span><span class="co"># eruptions_recent %&gt;% as.data.frame %&gt;% print(print.gap=2,width=1000,row.names=F,right=F) %&gt;% capture.output() %&gt;% </span></span>
<span><span class="co">#   str_replace("&lt;NA&gt;","NA  ") %&gt;% str_replace("^ *",'"') %&gt;% str_replace("( {2,})",'"\\1') %&gt;% str_replace('"name"',"name  ") %&gt;% write_lines(file="data/eruptions_recent.txt")</span></span></code></pre></div>
</div>
<div id="inspect-data" class="section level3" number="8.2.4">
<h3>
<span class="header-section-number">A.2.4</span> Inspect data<a class="anchor" aria-label="anchor" href="#inspect-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eruptions_recent</span></span></code></pre></div>
<pre><code># A tibble: 73 × 6
   volcano               start      stop       duration confirmed   vei
   &lt;chr&gt;                 &lt;date&gt;     &lt;date&gt;        &lt;dbl&gt; &lt;lgl&gt;     &lt;dbl&gt;
 1 Kīlauea               2024-06-03 2024-06-03        0 TRUE         NA
 2 Atka Volcanic Complex 2024-03-27 2024-03-27        0 TRUE         NA
 3 Ahyi                  2024-01-01 2024-03-27       86 TRUE         NA
 4 Kanaga                2023-12-18 2023-12-18        0 TRUE          1
 5 Ruby                  2023-09-14 2023-09-15        1 TRUE          1
 6 Shishaldin            2023-07-11 2023-11-03      115 TRUE          3
 7 Mauna Loa             2022-11-27 2022-12-10       13 TRUE          0
 8 Ahyi                  2022-11-18 2023-06-11      205 TRUE          1
 9 Kīlauea               2021-09-29 2023-09-16      717 TRUE          0
10 Pavlof                2021-08-05 2022-12-07      489 TRUE          2
# ℹ 63 more rows</code></pre>
<!--

### Scrape volcanoes info


``` r
nums <- c(332010, 311160, 284141, 311110, 284202, 311360, 332020, 312030, 284170,
         311120, 312070, 311060, 311240, 311300, 284305, 284193, 313030, 311130,
         311290, 284200, 312260, 313010, 321050, 284211, 244000, 315020, 312110,
         311190, 311070, 331031, 332000, 311310, 311180, 311320, 313040, 311340,
         311020, 311230, 284210, 312060, 284133, 312131, 284134, 312160, 311270,
         332080, 313020, 312140, 284140, 312150, 314010, 312090, 311210, 311260,
         284150, 284160, 323080, 311080, 312170, 312180, 323020, 321030, 323110,
         284180, 321010, 284190, 322010, 244010, 312130, 311350, 311050, 332040,
         311390, 332060, 312200, 321020, 311090, 323120, 327050, 323150, 323010,
         313050, 329010, 329020, 327040, 321040, 322020, 315030, 322110, 322030,
         322060, 244020, 322070, 314060, 323200, 324020, 323160, 324030, 312100,
         322040, 315001, 311140, 327120, 322190, 311111, 312190, 312050, 312080,
         328010, 331040, 315040, 332030, 322100, 322160, 324040, 327110, 312250,
         322170, 321060, 322090, 321070, 311380, 324010, 327812, 323170)

get_volc_info <- function(num){

  source <- "https://volcano.si.edu/volcano.cfm?vn={num}&vtab=Eruptions" %>%
    str_glue() %>%
    read_html()

  name <- source %>%
    html_nodes(xpath="//div[@class='volcano-title-container']/h3/text()") %>%
    HTMLdecode()

  info <- source %>%
    html_nodes(xpath="//div[@class='volcano-info-table']//li//text()") %>%
    as.character() %>%
    {setNames(.[1:4],.[5:8])}

  subinfo <- source %>%
    html_nodes(xpath="//div[@class='volcano-subinfo-table']//li[position()<5]//text()") %>%
    as.character() %>%
    {setNames(.[1:4],.[5:8])}

  c(name=name,info,subinfo)
}

library(parallel)
cl <- makeCluster(detectCores()-1)
clusterExport(cl,c("nums","get_volc_info"))
volcanoes_raw <- mclapply(nums,get_volc_info) %>% as.data.frame %>% unname %>% t %>% as.data.frame
stopCluster(cl)
write_csv(volcanoes_raw,"data/volcanoes_raw.csv")
```

### Process volcano info


``` r
volcanoes <- volcanoes_raw %>% 
  # these are already only US volcanoes, and Summit is just Elevation in meters
  select(-Country,-Summit) %>% 
  set_names(c("volcano","region","landform_type","last_known_eruption","latitude","longitude","summit_ft")) %>% 
  mutate(landform_type = str_replace_all(landform_type,"\\(\\w+\\)|\\?",""),
         last_known_eruption = parse_number(last_known_eruption) * if_else(str_detect(last_known_eruption,"BCE"),-1,1),
         latitude = parse_number(latitude) * if_else(str_detect(latitude,"S"),-1,1),
         longitude = parse_number(longitude) * if_else(str_detect(longitude,"W"),-1,1),
         summit_ft = parse_number(summit_ft) * if_else(volcano=="Ruby",-1,1)) %>% 
  separate(landform_type,into=c("landform","type"),sep=" \\| ") %>% 
  mutate(underwater = summit_ft < -131)
```

### Write out volcanoes info


``` r
write_csv(volcanoes,"data/volcanoes.csv")
```



### Inspect volcanoes info


``` r
volcanoes
volcanoes_raw
```

### Augment eruptions


``` r
eruptions_recent2 <- volcanoes %>% 
  select(volcano, landform, type, summit_ft, underwater) %>% 
  right_join(eruptions_recent,.)

write_csv(eruptions_recent2, file="data/eruptions_recent2.csv")
```




``` r
# print all columns
options(width=93)
eruptions_recent2
options(width=80)
```

-->
</div>
</div>
<div id="palmer-penguins-1" class="section level2" number="8.3">
<h2>
<span class="header-section-number">A.3</span> Palmer penguins<a class="anchor" aria-label="anchor" href="#palmer-penguins-1"><i class="fas fa-link"></i></a>
</h2>
<p>For the data visualization, I wanted a more feature rich dataset with a healthy combination of numerics and characters that is ready to go, easy to use, fun &amp; interesting, and would make good looking plots for the demos. I spent too long brainstorming ideas, including scraping additional info on the volcanoes, but wasn’t happy with the result. Then, while looking for inspiration, I found through Hadley Wickham’s excellent <a href="https://r4ds.hadley.nz/data-visualize">R4DS book</a> the <a href="https://allisonhorst.github.io/palmerpenguins/">Palmer penguins</a> dataset, which is absolutely perfect.</p>
<p>Now, I want students to continue practicing reading datasets, so the following code simple extracts the dataset therein and rewrites it out.</p>
<div id="write-out-data-1" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">A.3.1</span> Write out data<a class="anchor" aria-label="anchor" href="#write-out-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">penguins</span>,<span class="st">"data/penguins.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">drop_na</span>,<span class="st">"data/penguins_complete.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="inspect-data-1" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">A.3.2</span> Inspect data<a class="anchor" aria-label="anchor" href="#inspect-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span></span></code></pre></div>
</div>
</div>
<div id="college-enrollment" class="section level2" number="8.4">
<h2>
<span class="header-section-number">A.4</span> College enrollment<a class="anchor" aria-label="anchor" href="#college-enrollment"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last.yy</span> <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="st">"https://nces.ed.gov/programs/digest/current_tables.asp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span>xpath<span class="op">=</span><span class="st">"//select[@name='quickjump']/option[2]/text()"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">as.character</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.numeric</span></span>
<span><span class="op">}</span>,error <span class="op">=</span> \<span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="fl">30</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">100</span></span></code></pre></div>
<p>I also briefly needed a nice time series dataset with more than 1 groups to demonstrate line plots. Eventually I settled on <a href="https://nces.ed.gov/programs/digest/d23/tables/dt23_303.10.asp">table 303.10</a> of the National Center for Education Statistics (NCES) which contains historic college enrollment data, stratified by sex.</p>
<div id="process-data-1" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">A.4.1</span> Process data<a class="anchor" aria-label="anchor" href="#process-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enrollment</span> <span class="op">=</span> <span class="st">"https://nces.ed.gov/programs/digest/d{last.yy}/tables/dt{last.yy}_303.10.asp"</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">str_glue</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">read_html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span>xpath<span class="op">=</span><span class="st">"//div[@class='nces']/table[1]"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">html_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span>,<span class="op">]</span><span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">rownames_to_column</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"name"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Year|(Sex.*(Male|Female))|Nonprofit"</span>,ignore.case<span class="op">=</span><span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"male"</span>,<span class="st">"female"</span>,<span class="st">"nonprofit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">year</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="va">parse_number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">male</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">female</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="va">year</span><span class="op">&gt;</span><span class="fl">20</span>,</span>
<span>         <span class="va">year</span><span class="op">&lt;</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">10</span><span class="op">|</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">nonprofit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">nonprofit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>male <span class="op">=</span> <span class="va">male</span><span class="op">/</span><span class="fl">1e6</span>, female <span class="op">=</span> <span class="va">female</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">male</span><span class="op">:</span><span class="va">female</span>,names_to<span class="op">=</span><span class="st">"sex"</span>,values_to<span class="op">=</span><span class="st">"enrolled_millions"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="write-out-data-2" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">A.4.2</span> Write out data<a class="anchor" aria-label="anchor" href="#write-out-data-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">enrollment</span>, file<span class="op">=</span><span class="st">"data/enrollment.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="inspect-data-2" class="section level3" number="8.4.3">
<h3>
<span class="header-section-number">A.4.3</span> Inspect data<a class="anchor" aria-label="anchor" href="#inspect-data-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enrollment</span></span></code></pre></div>
<pre><code># A tibble: 146 × 3
    year sex    enrolled_millions
   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
 1  1947 male               1.66 
 2  1947 female             0.679
 3  1948 male               1.71 
 4  1948 female             0.694
 5  1949 male               1.72 
 6  1949 female             0.723
 7  1950 male               1.56 
 8  1950 female             0.721
 9  1951 male               1.39 
10  1951 female             0.711
# ℹ 136 more rows</code></pre>

</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/external-link.min.js" defer></script><script>
  $(function(){
    $(".note").addClass("alert alert-warning");
  });
  $(function(){
    $(".tip").addClass("alert alert-success");
  });
  $(function(){
    $(".def").addClass("alert alert-info");
  });
  $(function(){
    $(".def").addClass("alert alert-info");
  });
  $(function(){
    $(".col-lg-3").addClass("col-lg-2").removeClass("col-lg-3");
  });
  $(function(){
    $(".col-lg-7").addClass("col-lg-8").removeClass("col-lg-7");
  });
</script><!-- https://stackoverflow.com/a/37839683/25278020 --><script>
  $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show Source</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show Output</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show Plot</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});

</script><!-- https://www.tutorialrepublic.com/faq/how-to-change-href-attribute-of-a-hyperlink-using-jquery.php--><script>
  $(document).ready(function(){
    $("a.anchorjs-link").each(function(){
      var oldUrl = $(this).attr("href"); // Get current url
      var newUrl = oldUrl.replace(/^#(\d+-)+/,"#"); // Create new url
      $(this).attr("href", "#" + $(this).closest("div").attr("id"));  // Set href value
      $(this).attr("title", location.protocol + "//" + location.host + location.pathname + $(this).attr("href")); // Set title value
    });
  });
</script><!-- https://stackoverflow.com/a/10415599/25278020 --><script>
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.addedNodes && mutation.addedNodes.length > 0) {
            // element added to DOM
            var hasClass = [].some.call(mutation.addedNodes, function(el) {
                return el.classList.contains('bs-popover-top')
            });
            if (hasClass) {
              $("div.bs-popover-top a").each(function(){
                $(this).attr("target", "_blank");
              });
          }
        }
    });
});

var config = {
    attributes: true,
    childList: true,
    characterData: true
};

observer.observe(document.body, config);
</script><div class="chapter-nav">
<div class="prev"><a href="intro-to-dplyr.html"><span class="header-section-number">7</span> Intro to dplyr</a></div>
<div class="next"><a href="cheat-sheets.html"><span class="header-section-number">B</span> Cheat sheets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#datasets"><span class="header-section-number">A</span> Datasets</a></li>
<li><a class="nav-link" href="#datasets-list"><span class="header-section-number">A.1</span> List of datasets</a></li>
<li>
<a class="nav-link" href="#eruptions"><span class="header-section-number">A.2</span> Eruptions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-raw-data"><span class="header-section-number">A.2.1</span> Load raw data</a></li>
<li><a class="nav-link" href="#process-data"><span class="header-section-number">A.2.2</span> Process data</a></li>
<li><a class="nav-link" href="#write-out-data"><span class="header-section-number">A.2.3</span> Write out data</a></li>
<li><a class="nav-link" href="#inspect-data"><span class="header-section-number">A.2.4</span> Inspect data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#palmer-penguins-1"><span class="header-section-number">A.3</span> Palmer penguins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#write-out-data-1"><span class="header-section-number">A.3.1</span> Write out data</a></li>
<li><a class="nav-link" href="#inspect-data-1"><span class="header-section-number">A.3.2</span> Inspect data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#college-enrollment"><span class="header-section-number">A.4</span> College enrollment</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#process-data-1"><span class="header-section-number">A.4.1</span> Process data</a></li>
<li><a class="nav-link" href="#write-out-data-2"><span class="header-section-number">A.4.2</span> Write out data</a></li>
<li><a class="nav-link" href="#inspect-data-2"><span class="header-section-number">A.4.3</span> Inspect data</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bwu62/stat240-revamp/blob/master/datasets.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bwu62/stat240-revamp/edit/master/datasets.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 240 Revamp</strong>" was written by Bi Cheng Wu, with help from Bret Larget and Cameron Jones. It was last built on 2024-08-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
